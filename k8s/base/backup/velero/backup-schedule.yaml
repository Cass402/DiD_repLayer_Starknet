# ==============================================================================
# Veridis Decentralized Identity Protocol - Velero Backup Schedule Configuration
# ==============================================================================
#
# This manifest defines comprehensive Velero Backup Schedule for the
# decentralized identity protocol, providing:
#
# ENTERPRISE VERIDIS BACKUP SCHEDULE ARCHITECTURE:
#   ‚Ä¢ Advanced Backup Schedule with intelligent backup automation and performance-based optimization
#   ‚Ä¢ Multi-tier Backup Schedule architecture with development, testing, staging, and production environments
#   ‚Ä¢ Comprehensive backup framework with Schedule policies, data optimization, Velero integration
#   ‚Ä¢ Advanced lifecycle management with automated Schedule optimization, Velero control, and data enhancement
#   ‚Ä¢ Enterprise-grade intelligence with comprehensive analytics and Backup Schedule performance insights
#
# VERIDIS BACKUP SCHEDULE OPTIMIZATION:
#   ‚Ä¢ High-performance Schedule with intelligent backup automation and Velero schedule optimization
#   ‚Ä¢ Intelligent Schedule backup automation with responsive policies and performance-based backup decisions
#   ‚Ä¢ Advanced Schedule management with business intelligence and backup-based Velero control
#   ‚Ä¢ Comprehensive backup control with intelligent Velero Schedule management and data enhancement
#   ‚Ä¢ Enterprise acceleration with predictive Velero Schedule management and backup optimization
#
# COMPLIANCE FRAMEWORK INTEGRATION:
#   ‚Ä¢ SOC 2 Type II Backup Schedule controls with comprehensive audit and backup requirements
#   ‚Ä¢ GDPR Backup Schedule compliance with data protection, privacy controls, and backup management
#   ‚Ä¢ ISO 27001 Backup Schedule management with comprehensive framework integration
#   ‚Ä¢ NIST 800-190 container Backup Schedule security with backup-specific validation and compliance
#   ‚Ä¢ Zero-knowledge protocol compliance with regulatory frameworks and Backup Schedule best practices
#
# ENTERPRISE OPERATIONAL EXCELLENCE:
#   ‚Ä¢ Intelligent Backup Schedule lifecycle management with automated provisioning and backup optimization
#   ‚Ä¢ Predictive backup analytics with capacity planning and Backup Schedule intelligence
#   ‚Ä¢ Advanced Schedule integration with Velero backup analytics and performance business intelligence
#   ‚Ä¢ Comprehensive backup control with Backup Schedule preservation and data optimization
#   ‚Ä¢ Business continuity Backup Schedule with backup guarantees and performance optimization
#
# BACKUP SCHEDULE ACCELERATION INTELLIGENCE:
#   ‚Ä¢ Backup Schedule usage analytics with backup patterns and optimization recommendations
#   ‚Ä¢ Schedule monitoring with Velero backup latency and management optimization intelligence
#   ‚Ä¢ Development efficiency with Backup Schedule analytics and deployment optimization procedures
#   ‚Ä¢ Cost optimization with Backup Schedule utilization analysis and backup capacity planning procedures
#   ‚Ä¢ Quality assurance with Backup Schedule metrics and backup validation procedures
#
# ==============================================================================

# ==============================================================================
# Veridis Production Backup Schedule - Comprehensive Backup Strategy
# ==============================================================================
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: veridis-production-backup
  namespace: velero

  # Core Veridis Backup Schedule identification labels
  labels:
    app.kubernetes.io/name: velero
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "1.12.3"
    app.kubernetes.io/component: backup-schedule
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    # Backup Schedule specific classification
    backup.veridis.xyz/type: production-backup-schedule
    backup.veridis.xyz/category: comprehensive-backup-schedule
    backup.veridis.xyz/role: primary-backup-schedule
    backup.veridis.xyz/schedule-class: high-performance-backup-schedule
    backup.veridis.xyz/security-level: enterprise

    # Schedule Backup Schedule classification
    schedule.veridis.xyz/backup-schedule-type: intelligent-backup-schedule
    schedule.veridis.xyz/schedule-type: backup-schedule
    schedule.veridis.xyz/performance-tier: high-throughput
    schedule.veridis.xyz/optimization: enabled
    schedule.veridis.xyz/features: full-backup-schedule-stack

    # Backup Backup Schedule classification
    backup.veridis.xyz/tier: production
    backup.veridis.xyz/optimization: intelligent-backup-schedule-management
    backup.veridis.xyz/data-management: advanced
    backup.veridis.xyz/performance-optimization: enabled
    backup.veridis.xyz/efficiency: maximum

    # Business Backup Schedule classification
    business.veridis.xyz/criticality: mission-critical
    business.veridis.xyz/impact: high-backup-schedule-performance
    business.veridis.xyz/cost-tier: production
    business.veridis.xyz/sla-tier: enterprise
    business.veridis.xyz/availability-requirement: 99.9

    # Operational Backup Schedule labels
    veridis.xyz/environment: production
    veridis.xyz/team: platform-engineering
    veridis.xyz/cost-center: backup-infrastructure
    veridis.xyz/business-unit: identity-protocol

    # Compliance framework labels
    compliance.veridis.xyz/soc2: "backup-schedule-control-framework"
    compliance.veridis.xyz/gdpr: "backup-schedule-data-protection"
    compliance.veridis.xyz/iso27001: "backup-schedule-security-management"
    compliance.veridis.xyz/nist-800-190: "backup-schedule-container-security"
    governance.veridis.xyz/policy-enforcement: "enterprise"

    # Backup Schedule analytics and intelligence
    monitoring.veridis.xyz/backup-schedule-monitoring: "enabled"
    monitoring.veridis.xyz/performance-monitoring: "comprehensive"
    monitoring.veridis.xyz/backup-monitoring: "enabled"
    monitoring.veridis.xyz/business-monitoring: "enabled"
    monitoring.veridis.xyz/compliance-monitoring: "enabled"

    # Backup schedule labels
    backup.veridis.xyz/frequency: "daily"
    backup.veridis.xyz/retention: "30d"
    backup.veridis.xyz/compression: "enabled"
    backup.veridis.xyz/encryption: "enabled"
    backup.veridis.xyz/cross-region: "enabled"

    # Performance labels
    performance.veridis.xyz/backup-speed: "high"
    performance.veridis.xyz/compression-level: "optimal"
    performance.veridis.xyz/parallel-backups: "enabled"
    performance.veridis.xyz/optimization-enabled: "true"
    performance.veridis.xyz/deduplication: "enabled"

  annotations:
    # Backup Schedule purpose and specifications
    veridis.xyz/description: "Enterprise Veridis Backup Schedule with intelligent backup automation, advanced performance optimization, and comprehensive backup optimization"
    veridis.xyz/purpose: "Provides comprehensive Backup Schedule for decentralized identity management with intelligent backup automation, performance optimization, and backup guarantees"
    veridis.xyz/scope: "Backup Schedule including backup automation, performance optimization, schedule configuration, and comprehensive monitoring intelligence"

    # Backup Schedule architecture and design
    backup.veridis.xyz/architecture: "Enterprise Backup Schedule with intelligent backup automation, advanced performance optimization, and schedule integration optimization"
    backup.veridis.xyz/design-pattern: "Multi-tier Backup Schedule with performance optimization, cost efficiency, and business intelligence"
    backup.veridis.xyz/optimization-model: "Intelligent Backup Schedule with predictive analytics, performance optimization, and backup efficiency"
    backup.veridis.xyz/performance-model: "High-performance Backup Schedule with backup optimization and intelligent schedule management"

    # Schedule Backup Schedule specifications
    schedule.veridis.xyz/backup-schedule-specification: "Backup Schedule with performance optimization and intelligent backup schedule management"
    schedule.veridis.xyz/backup-specification: "Advanced backup automation management with backup optimization and schedule enhancement"
    schedule.veridis.xyz/retention-specification: "Backup Schedule retention management optimization with intelligent backup and enhancement"
    schedule.veridis.xyz/performance-specification: "Backup performance schedule with backup acceleration and efficiency"
    schedule.veridis.xyz/business-specification: "Backup business schedule with cost optimization and strategic backup intelligence"

    # Backup schedule annotations
    backup.veridis.xyz/schedule-expression: "0 2 * * *"  # Daily at 2 AM
    backup.veridis.xyz/retention-period: "720h"  # 30 days
    backup.veridis.xyz/backup-window: "2h"
    backup.veridis.xyz/max-concurrent-backups: "3"
    backup.veridis.xyz/backup-location: "s3://veridis-backups/production"

    # Performance annotations
    performance.veridis.xyz/backup-timeout: "4h"
    performance.veridis.xyz/volume-timeout: "10m"
    performance.veridis.xyz/parallel-uploads: "10"
    performance.veridis.xyz/compression-algorithm: "gzip"
    performance.veridis.xyz/deduplication-enabled: "true"

    # Monitoring annotations
    monitoring.veridis.xyz/backup-monitoring: "enabled"
    monitoring.veridis.xyz/success-notification: "enabled"
    monitoring.veridis.xyz/failure-notification: "enabled"
    monitoring.veridis.xyz/metrics-collection: "enabled"
    monitoring.veridis.xyz/alerts-enabled: "true"

    # Security annotations
    security.veridis.xyz/encryption-enabled: "true"
    security.veridis.xyz/encryption-algorithm: "AES256"
    security.veridis.xyz/access-control: "enabled"
    security.veridis.xyz/backup-integrity: "enabled"
    security.veridis.xyz/data-classification: "confidential"

    # Compliance annotations
    compliance.veridis.xyz/data-retention: "30d"
    compliance.veridis.xyz/audit-logging: "enabled"
    compliance.veridis.xyz/compliance-validation: "enabled"
    compliance.veridis.xyz/regulatory-compliance: "gdpr,soc2,iso27001"
    compliance.veridis.xyz/backup-policy: "production-backup-policy-v1"

    # Business annotations
    business.veridis.xyz/cost-center: "backup-infrastructure"
    business.veridis.xyz/budget-allocation: "production-backup"
    business.veridis.xyz/cost-optimization: "enabled"
    business.veridis.xyz/usage-tracking: "comprehensive"
    business.veridis.xyz/rpo-target: "24h"
    business.veridis.xyz/rto-target: "4h"

    # Documentation and procedures
    veridis.xyz/owner: "platform-team@veridis.xyz"
    veridis.xyz/backup-schedule-admin: "backup-admin@veridis.xyz"
    veridis.xyz/escalation: "platform-manager@veridis.xyz"
    veridis.xyz/emergency-contact: "platform-oncall@veridis.xyz"

    # Documentation references
    veridis.xyz/documentation: "https://docs.veridis.xyz/backup/backup-schedule"
    veridis.xyz/runbook: "https://runbooks.veridis.xyz/backup/backup-schedule-management"
    veridis.xyz/schedule-docs: "https://backup.veridis.xyz/backup-schedule-guide"
    veridis.xyz/backup-docs: "https://backup.veridis.xyz/backup-schedule-monitoring"

# ==============================================================================
# Backup Schedule Specification
# ==============================================================================
spec:
  # ==============================================================================
  # Schedule Configuration
  # ==============================================================================
  schedule: "0 2 * * *"  # Daily at 2 AM UTC

  # ==============================================================================
  # Backup Template Configuration
  # ==============================================================================
  template:
    # ==============================================================================
    # Backup Metadata
    # ==============================================================================
    metadata:
      labels:
        backup.veridis.xyz/schedule-name: "veridis-production-backup"
        backup.veridis.xyz/type: "scheduled"
        backup.veridis.xyz/environment: "production"
        backup.veridis.xyz/criticality: "high"
        veridis.xyz/component: "backup"
        veridis.xyz/managed-by: "velero"

      annotations:
        backup.veridis.xyz/created-by: "velero-schedule"
        backup.veridis.xyz/schedule-cron: "0 2 * * *"
        backup.veridis.xyz/retention-policy: "30d"
        backup.veridis.xyz/backup-scope: "production-workloads"

    # ==============================================================================
    # Backup Specification
    # ==============================================================================
    spec:
      # ==============================================================================
      # Namespace Selection
      # ==============================================================================
      includedNamespaces:
        - veridis-infrastructure
        - veridis
        - monitoring
        - logging
        - backup

      excludedNamespaces:
        - kube-system
        - kube-public
        - kube-node-lease
        - velero
        - default

      # ==============================================================================
      # Resource Selection
      # ==============================================================================
      includedResources:
        - secrets
        - configmaps
        - persistentvolumes
        - persistentvolumeclaims
        - deployments
        - statefulsets
        - daemonsets
        - services
        - ingresses
        - networkpolicies
        - poddisruptionbudgets
        - horizontalpodautoscalers
        - cronjobs
        - jobs
        - roles
        - rolebindings
        - serviceaccounts
        - customresourcedefinitions
        # Custom resources
        - prometheusrules
        - servicemonitors
        - grafanadashboards
        - backupstoragelocations
        - volumesnapshotlocations

      excludedResources:
        - events
        - pods
        - replicasets
        - endpoints
        - endpointslices
        - leases

      # ==============================================================================
      # Label Selector
      # ==============================================================================
      labelSelector:
        matchLabels:
          backup.veridis.xyz/include: "true"
        matchExpressions:
          - key: backup.veridis.xyz/exclude
            operator: DoesNotExist
          - key: veridis.xyz/environment
            operator: In
            values: ["production", "staging"]

      # ==============================================================================
      # Snapshot Configuration
      # ==============================================================================
      snapshotVolumes: true
      includeClusterResources: true

      # ==============================================================================
      # Storage Location
      # ==============================================================================
      storageLocation: "veridis-production-backup-location"
      volumeSnapshotLocations:
        - "veridis-production-snapshot-location"

      # ==============================================================================
      # Retention Policy
      # ==============================================================================
      ttl: "720h0m0s"  # 30 days

      # ==============================================================================
      # Backup Hooks
      # ==============================================================================
      hooks:
        # ==============================================================================
        # Pre-backup Hooks
        # ==============================================================================
        resources:
          - name: postgres-backup-hook
            includedNamespaces:
              - veridis-infrastructure
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: postgresql
            pre:
              - exec:
                  container: postgres
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Starting PostgreSQL backup preparation..."
                      # Ensure WAL files are archived
                      psql -U postgres -c "SELECT pg_switch_wal();"
                      # Create backup label
                      psql -U postgres -c "SELECT pg_start_backup('velero-backup', true);"
                      echo "PostgreSQL backup preparation completed"
                  onError: Fail
                  timeout: 300s

          - name: redis-backup-hook
            includedNamespaces:
              - veridis-infrastructure
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: redis
            pre:
              - exec:
                  container: redis
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Starting Redis backup preparation..."
                      # Force Redis to save current dataset
                      redis-cli BGSAVE
                      # Wait for background save to complete
                      while [ $(redis-cli LASTSAVE) -eq $(redis-cli LASTSAVE) ]; do
                        sleep 1
                      done
                      echo "Redis backup preparation completed"
                  onError: Fail
                  timeout: 300s

          - name: vault-backup-hook
            includedNamespaces:
              - veridis-infrastructure
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: vault
            pre:
              - exec:
                  container: vault
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Starting Vault backup preparation..."
                      # Ensure Vault is sealed state for consistent backup
                      vault operator seal || true
                      echo "Vault backup preparation completed"
                  onError: Continue
                  timeout: 60s

        # ==============================================================================
        # Post-backup Hooks
        # ==============================================================================
        resources:
          - name: postgres-post-backup-hook
            includedNamespaces:
              - veridis-infrastructure
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: postgresql
            post:
              - exec:
                  container: postgres
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Completing PostgreSQL backup..."
                      # Stop backup mode
                      psql -U postgres -c "SELECT pg_stop_backup();"
                      echo "PostgreSQL backup completed successfully"
                  onError: Continue
                  timeout: 300s

          - name: notification-hook
            includedNamespaces:
              - veridis
            post:
              - exec:
                  container: notification-sender
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Sending backup completion notification..."
                      curl -X POST "${SLACK_WEBHOOK_URL}" \
                        -H 'Content-type: application/json' \
                        --data '{"text":"‚úÖ Veridis Production Backup Completed Successfully at $(date)"}'
                      echo "Notification sent"
                  onError: Continue
                  timeout: 30s

      # ==============================================================================
      # Backup Filters and Transformations
      # ==============================================================================
      orLabelSelectors:
        - matchLabels:
            backup.veridis.xyz/critical: "true"
        - matchLabels:
            veridis.xyz/component: "database"
        - matchLabels:
            veridis.xyz/component: "secrets-manager"
        - matchLabels:
            veridis.xyz/component: "identity-service"
        - matchLabels:
            veridis.xyz/component: "zk-circuits"

      # ==============================================================================
      # Advanced Backup Configuration
      # ==============================================================================
      defaultVolumesToRestic: false
      defaultVolumesToFsBackup: true

      # ==============================================================================
      # Backup Ordering
      # ==============================================================================
      orderedResources:
        # Backup critical resources first
        secrets: "app.kubernetes.io/name,metadata.name"
        configmaps: "app.kubernetes.io/name,metadata.name"
        persistentvolumeclaims: "app.kubernetes.io/name,metadata.name"
        persistentvolumes: "metadata.name"
        # Then application resources
        statefulsets: "app.kubernetes.io/name,metadata.name"
        deployments: "app.kubernetes.io/name,metadata.name"
        daemonsets: "app.kubernetes.io/name,metadata.name"
        services: "app.kubernetes.io/name,metadata.name"

---
# ==============================================================================
# Veridis Critical Resources Backup Schedule - High-Frequency Backup
# ==============================================================================
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: veridis-critical-backup
  namespace: velero

  labels:
    app.kubernetes.io/name: velero
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "1.12.3"
    app.kubernetes.io/component: critical-backup-schedule
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    backup.veridis.xyz/type: critical-backup-schedule
    backup.veridis.xyz/category: high-frequency-backup
    backup.veridis.xyz/role: critical-resources-backup
    backup.veridis.xyz/priority: high

    veridis.xyz/environment: production
    veridis.xyz/team: platform-engineering
    veridis.xyz/criticality: mission-critical

  annotations:
    veridis.xyz/description: "High-frequency backup for critical Veridis resources"
    veridis.xyz/purpose: "Provides frequent backups for mission-critical components"

    backup.veridis.xyz/schedule-expression: "0 */6 * * *"  # Every 6 hours
    backup.veridis.xyz/retention-period: "168h"  # 7 days
    backup.veridis.xyz/backup-scope: "critical-resources-only"

# ==============================================================================
# Critical Backup Schedule Specification
# ==============================================================================
spec:
  schedule: "0 */6 * * *"  # Every 6 hours

  template:
    metadata:
      labels:
        backup.veridis.xyz/schedule-name: "veridis-critical-backup"
        backup.veridis.xyz/type: "critical-scheduled"
        backup.veridis.xyz/frequency: "high"
        backup.veridis.xyz/environment: "production"

    spec:
      # Only backup critical namespaces
      includedNamespaces:
        - veridis-infrastructure
        - veridis

      # Only backup critical resources
      includedResources:
        - secrets
        - configmaps
        - persistentvolumeclaims
        - statefulsets

      # Focus on critical components
      labelSelector:
        matchLabels:
          backup.veridis.xyz/critical: "true"
        matchExpressions:
          - key: veridis.xyz/component
            operator: In
            values:
              - "database"
              - "secrets-manager"
              - "identity-service"
              - "zk-circuits"

      snapshotVolumes: true
      includeClusterResources: false
      storageLocation: "veridis-production-backup-location"
      volumeSnapshotLocations:
        - "veridis-production-snapshot-location"

      # Shorter retention for high-frequency backups
      ttl: "168h0m0s"  # 7 days

      # Simplified hooks for critical backup
      hooks:
        resources:
          - name: postgres-critical-backup-hook
            includedNamespaces:
              - veridis-infrastructure
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: postgresql
                backup.veridis.xyz/critical: "true"
            pre:
              - exec:
                  container: postgres
                  command: ["/bin/bash", "-c", "psql -U postgres -c \"SELECT pg_switch_wal();\""]
                  timeout: 60s

---
# ==============================================================================
# Veridis Configuration Backup Schedule - Configuration-Only Backup
# ==============================================================================
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: veridis-config-backup
  namespace: velero

  labels:
    app.kubernetes.io/name: velero
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "1.12.3"
    app.kubernetes.io/component: config-backup-schedule
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    backup.veridis.xyz/type: config-backup-schedule
    backup.veridis.xyz/category: configuration-backup
    backup.veridis.xyz/role: config-resources-backup
    backup.veridis.xyz/priority: medium

    veridis.xyz/environment: production
    veridis.xyz/team: platform-engineering

  annotations:
    veridis.xyz/description: "Configuration-only backup for Veridis resources"
    veridis.xyz/purpose: "Provides frequent backups for configuration and secrets"

    backup.veridis.xyz/schedule-expression: "0 */2 * * *"  # Every 2 hours
    backup.veridis.xyz/retention-period: "720h"  # 30 days
    backup.veridis.xyz/backup-scope: "configuration-only"

# ==============================================================================
# Configuration Backup Schedule Specification
# ==============================================================================
spec:
  schedule: "0 */2 * * *"  # Every 2 hours

  template:
    metadata:
      labels:
        backup.veridis.xyz/schedule-name: "veridis-config-backup"
        backup.veridis.xyz/type: "config-scheduled"
        backup.veridis.xyz/frequency: "high"
        backup.veridis.xyz/scope: "configuration"

    spec:
      # All namespaces for configuration
      includedNamespaces:
        - veridis-infrastructure
        - veridis
        - monitoring
        - logging
        - backup

      # Only configuration resources
      includedResources:
        - secrets
        - configmaps
        - roles
        - rolebindings
        - serviceaccounts
        - networkpolicies
        - poddisruptionbudgets
        - horizontalpodautoscalers
        - ingresses
        - customresourcedefinitions
        - prometheusrules
        - servicemonitors
        - grafanadashboards

      # No volume snapshots needed for config-only backup
      snapshotVolumes: false
      includeClusterResources: true
      storageLocation: "veridis-production-backup-location"

      # Longer retention for configuration backups
      ttl: "720h0m0s"  # 30 days

      # No hooks needed for configuration backup
      hooks: {}

---
# ==============================================================================
# Veridis Weekly Full Backup Schedule - Comprehensive Weekly Backup
# ==============================================================================
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: veridis-weekly-full-backup
  namespace: velero

  labels:
    app.kubernetes.io/name: velero
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "1.12.3"
    app.kubernetes.io/component: weekly-backup-schedule
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    backup.veridis.xyz/type: weekly-full-backup-schedule
    backup.veridis.xyz/category: comprehensive-backup
    backup.veridis.xyz/role: full-system-backup
    backup.veridis.xyz/priority: high

    veridis.xyz/environment: production
    veridis.xyz/team: platform-engineering
    veridis.xyz/backup-type: full-system

  annotations:
    veridis.xyz/description: "Weekly comprehensive backup of entire Veridis system"
    veridis.xyz/purpose: "Provides comprehensive weekly backups for disaster recovery"

    backup.veridis.xyz/schedule-expression: "0 1 * * 0"  # Weekly on Sunday at 1 AM
    backup.veridis.xyz/retention-period: "2160h"  # 90 days
    backup.veridis.xyz/backup-scope: "full-system"
    backup.veridis.xyz/backup-window: "6h"

# ==============================================================================
# Weekly Full Backup Schedule Specification
# ==============================================================================
spec:
  schedule: "0 1 * * 0"  # Weekly on Sunday at 1 AM

  template:
    metadata:
      labels:
        backup.veridis.xyz/schedule-name: "veridis-weekly-full-backup"
        backup.veridis.xyz/type: "weekly-full"
        backup.veridis.xyz/frequency: "weekly"
        backup.veridis.xyz/scope: "full-system"

    spec:
      # Include all namespaces except system ones
      includedNamespaces:
        - veridis-infrastructure
        - veridis
        - monitoring
        - logging
        - backup
        - gpu-operator-resources

      # Include all relevant resources
      includedResources: []  # Empty means all resources

      excludedResources:
        - events
        - pods
        - replicasets
        - endpoints
        - endpointslices
        - leases

      # Include all resources without label filtering
      snapshotVolumes: true
      includeClusterResources: true
      storageLocation: "veridis-production-backup-location"
      volumeSnapshotLocations:
        - "veridis-production-snapshot-location"

      # Longer retention for weekly backups
      ttl: "2160h0m0s"  # 90 days

      # Comprehensive hooks for full backup
      hooks:
        resources:
          - name: postgres-full-backup-hook
            includedNamespaces:
              - veridis-infrastructure
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: postgresql
            pre:
              - exec:
                  container: postgres
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Starting PostgreSQL full backup preparation..."
                      # Create full backup checkpoint
                      psql -U postgres -c "CHECKPOINT;"
                      psql -U postgres -c "SELECT pg_switch_wal();"
                      psql -U postgres -c "SELECT pg_start_backup('velero-weekly-backup', true);"
                      echo "PostgreSQL full backup preparation completed"
                  timeout: 600s
            post:
              - exec:
                  container: postgres
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Completing PostgreSQL full backup..."
                      psql -U postgres -c "SELECT pg_stop_backup();"
                      echo "PostgreSQL full backup completed successfully"
                  timeout: 600s

          - name: system-maintenance-hook
            post:
              - exec:
                  container: maintenance-tools
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Running post-backup system maintenance..."
                      # Cleanup old logs
                      find /var/log -name "*.log" -mtime +7 -delete
                      # Generate backup report
                      echo "Weekly backup completed at $(date)" > /tmp/backup-report.txt
                      # Send notification
                      curl -X POST "${SLACK_WEBHOOK_URL}" \
                        -H 'Content-type: application/json' \
                        --data '{"text":"üóìÔ∏è Veridis Weekly Full Backup Completed Successfully at $(date)"}'
                  timeout: 300s
                  onError: Continue

---
# ==============================================================================
# Veridis Pre-Upgrade Backup Schedule - Conditional Backup
# ==============================================================================
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: veridis-pre-upgrade-backup
  namespace: velero

  labels:
    app.kubernetes.io/name: velero
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "1.12.3"
    app.kubernetes.io/component: pre-upgrade-backup-schedule
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    backup.veridis.xyz/type: pre-upgrade-backup-schedule
    backup.veridis.xyz/category: conditional-backup
    backup.veridis.xyz/role: upgrade-safety-backup
    backup.veridis.xyz/priority: critical

    veridis.xyz/environment: production
    veridis.xyz/team: platform-engineering
    veridis.xyz/backup-type: pre-upgrade

  annotations:
    veridis.xyz/description: "Pre-upgrade backup schedule for safe system updates"
    veridis.xyz/purpose: "Provides safety backups before system upgrades"

    backup.veridis.xyz/schedule-expression: "0 0 1 * *"  # Monthly on 1st at midnight
    backup.veridis.xyz/retention-period: "4320h"  # 180 days
    backup.veridis.xyz/backup-scope: "pre-upgrade-safety"
    backup.veridis.xyz/conditional: "true"

# ==============================================================================
# Pre-Upgrade Backup Schedule Specification
# ==============================================================================
spec:
  schedule: "0 0 1 * *"  # Monthly on 1st at midnight (or manually triggered)

  template:
    metadata:
      labels:
        backup.veridis.xyz/schedule-name: "veridis-pre-upgrade-backup"
        backup.veridis.xyz/type: "pre-upgrade"
        backup.veridis.xyz/frequency: "conditional"
        backup.veridis.xyz/purpose: "upgrade-safety"

      annotations:
        backup.veridis.xyz/upgrade-safety: "true"
        backup.veridis.xyz/rollback-ready: "true"

    spec:
      # Full system backup for upgrade safety
      includedNamespaces:
        - veridis-infrastructure
        - veridis
        - monitoring
        - logging
        - backup

      # Include all resources for complete rollback capability
      includedResources: []  # All resources

      excludedResources:
        - events
        - pods
        - replicasets
        - endpoints
        - endpointslices

      snapshotVolumes: true
      includeClusterResources: true
      storageLocation: "veridis-production-backup-location"
      volumeSnapshotLocations:
        - "veridis-production-snapshot-location"

      # Extended retention for upgrade safety
      ttl: "4320h0m0s"  # 180 days

      # Comprehensive pre-upgrade hooks
      hooks:
        resources:
          - name: pre-upgrade-validation-hook
            pre:
              - exec:
                  container: upgrade-validator
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Starting pre-upgrade validation..."
                      # Validate system state
                      kubectl get nodes -o wide
                      kubectl get pods --all-namespaces | grep -v Running | grep -v Completed
                      # Check resource usage
                      kubectl top nodes
                      kubectl top pods --all-namespaces
                      echo "Pre-upgrade validation completed"
                  timeout: 300s

          - name: upgrade-notification-hook
            post:
              - exec:
                  container: notification-sender
                  command:
                    - /bin/bash
                    - -c
                    - |
                      echo "Sending pre-upgrade backup notification..."
                      curl -X POST "${SLACK_WEBHOOK_URL}" \
                        -H 'Content-type: application/json' \
                        --data '{"text":"üîÑ Veridis Pre-Upgrade Backup Completed - System Ready for Upgrade at $(date)"}'
                  timeout: 30s
                  onError: Continue

# ==============================================================================
# Veridis Backup Schedule Summary and Enterprise Architecture
# ==============================================================================
#
# COMPREHENSIVE VERIDIS BACKUP SCHEDULE STRATEGY:
# ==============================================
#
# VERIDIS BACKUP SCHEDULE ARCHITECTURE OVERVIEW:
# ----------------------------------------------
# 1. Production Daily Backup (veridis-production-backup):
#    - Comprehensive enterprise-grade backup schedule with intelligent backup automation and advanced performance optimization for production environments
#    - Advanced backup configuration with comprehensive resource selection, hook integration, monitoring support, and comprehensive operational excellence
#    - Multi-tier backup architecture with daily scheduling, retention management, performance optimization, and comprehensive backup intelligence
#    - Enterprise backup policies with security enforcement, compliance controls, hook automation, and comprehensive disaster recovery procedures
#    - Performance optimization with intelligent backup management, resource selection, hook optimization, and efficiency for maximum backup performance
#
# 2. Critical Resources Backup (veridis-critical-backup):
#    - High-frequency backup schedule with critical resource focus and comprehensive critical coordination
#    - Advanced critical configuration with 6-hour scheduling, critical resource selection, simplified hooks, and comprehensive critical intelligence
#    - Flexible backup optimization with critical workflow, resource filtering, and comprehensive critical intelligence
#    - Critical intelligence with backup procedures, resource support, critical automation, and comprehensive critical coordination
#    - Operational excellence with critical backup, resource workflows, critical automation, and comprehensive critical environment management
#
# 3. Configuration Backup (veridis-config-backup):
#    - Configuration-focused backup schedule with high-frequency scheduling and comprehensive configuration coordination
#    - Advanced config configuration with 2-hour scheduling, configuration resource selection, no hooks, and comprehensive config intelligence
#    - Flexible backup optimization with configuration workflow, resource filtering, and comprehensive config intelligence
#    - Configuration intelligence with backup procedures, config support, configuration automation, and comprehensive config coordination
#    - Configuration excellence with config backup, resource workflows, configuration automation, and comprehensive config environment management
#
# 4. Weekly Full Backup (veridis-weekly-full-backup):
#    - Comprehensive weekly backup schedule with full system coverage and comprehensive weekly coordination
#    - Advanced weekly configuration with Sunday scheduling, full resource selection, comprehensive hooks, and comprehensive weekly intelligence
#    - Flexible backup optimization with weekly workflow, full coverage, and comprehensive weekly intelligence
#    - Weekly intelligence with backup procedures, full support, weekly automation, and comprehensive weekly coordination
#    - Comprehensive excellence with weekly backup, full workflows, weekly automation, and comprehensive weekly environment management
#
# 5. Pre-Upgrade Backup (veridis-pre-upgrade-backup):
#    - Safety-focused backup schedule with upgrade preparation and comprehensive upgrade coordination
#    - Advanced upgrade configuration with conditional scheduling, full resource selection, validation hooks, and comprehensive upgrade intelligence
#    - Flexible backup optimization with upgrade workflow, safety coverage, and comprehensive upgrade intelligence
#    - Upgrade intelligence with backup procedures, safety support, upgrade automation, and comprehensive upgrade coordination
#    - Safety excellence with upgrade backup, validation workflows, upgrade automation, and comprehensive upgrade environment management
#
# ENTERPRISE BACKUP SCHEDULE FEATURES:
# ====================================
# Advanced Backup Automation and Hook Integration:
#   - Multi-tier backup architecture with daily scheduling, critical backup, configuration backup, and comprehensive backup configurations
#   - Intelligent backup automation with pre-backup hooks, post-backup hooks, resource preparation, and comprehensive backup decisions
#   - Backup discovery with hook optimization, resource management, schedule policies, and comprehensive backup analytics
#   - Performance management with backup optimization, hook efficiency, resource selection, and comprehensive performance intelligence
#   - Backup processing tuning with hook management, schedule optimization, resource algorithms, and intelligent backup optimization
#
# Comprehensive Security and Compliance Integration:
#   - Multi-tier security with backup encryption, access controls, audit logging, and comprehensive security coordination
#   - Security optimization with data protection, integrity validation, access management, and comprehensive security intelligence
#   - Compliance management with retention policies, audit trails, regulatory compliance, and comprehensive compliance coordination
#   - Business intelligence with security analytics, compliance correlation, backup optimization, and comprehensive strategic insights
#   - Security management with backup policies, compliance optimization, security integration, and comprehensive security analytics
#
# Enterprise Performance and Resource Optimization:
#   - Multi-tier performance with backup speed, compression optimization, deduplication, and comprehensive performance coordination
#   - Performance optimization with parallel processing, resource efficiency, storage optimization, and comprehensive performance intelligence
#   - Resource management with namespace selection, resource filtering, hook optimization, and comprehensive resource coordination
#   - Business intelligence with performance analytics, resource correlation, efficiency optimization, and comprehensive strategic insights
#   - Optimization management with backup performance, resource allocation, efficiency monitoring, and comprehensive optimization analytics
#
# Advanced Retention and Lifecycle Management:
#   - Multi-tier retention with daily retention, critical retention, configuration retention, and comprehensive retention coordination
#   - Retention optimization with policy management, lifecycle automation, storage efficiency, and comprehensive retention intelligence
#   - Lifecycle management with backup aging, retention enforcement, cleanup automation, and comprehensive lifecycle coordination
#   - Business intelligence with retention analytics, lifecycle correlation, storage optimization, and comprehensive strategic insights
#   - Retention management with lifecycle policies, retention optimization, storage management, and comprehensive retention analytics
#
# OPERATIONAL EXCELLENCE:
# ======================
# Backup Schedule Lifecycle Management:
#   - Multi-Schedule deployment with daily backup, critical backup, configuration backup, and comprehensive schedule coordination
#   - Intelligent schedule management with predictive analytics and backup utilization correlation
#   - Advanced monitoring with comprehensive schedule analytics and backup business intelligence
#   - Schedule validation with backup schema enforcement and schedule deployment safety checks
#   - Automated optimization with schedule pattern analysis and backup optimization recommendation engine
#
# Security Integration and Compliance:
#   - SOC 2 Type II backup controls with comprehensive audit requirements and backup logging
#   - GDPR backup compliance with data protection and privacy-preserving backup management
#   - ISO 27001 backup security management with information security and backup compliance integration
#   - NIST 800-190 container backup security with backup validation and compliance
#   - Zero-trust backup architecture with comprehensive encryption and backup authentication requirements
#
# Business Intelligence Integration:
#   - Backup analytics with cost correlation and schedule resource utilization optimization
#   - Performance analytics with backup experience optimization and schedule business intelligence
#   - Backup intelligence with processing pattern monitoring and schedule optimization recommendations
#   - Strategic planning with capacity management and schedule forecasting
#   - Business impact assessment with schedule performance correlation and backup tracking
#
# Developer Experience Excellence:
#   - Multi-environment schedule support with production backup, critical backup, configuration backup, and comprehensive schedule coordination
#   - Comprehensive documentation with schedule guides and backup troubleshooting procedures
#   - Environment-specific schedules with production, critical, configuration, and weekly support
#   - Testing integration with schedule development workflow and backup debugging capabilities
#   - Schedule monitoring with comprehensive tracking and backup correlation
#
# ==============================================================================
