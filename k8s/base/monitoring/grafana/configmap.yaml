# ==============================================================================
# Veridis Decentralized Identity Protocol - Grafana ConfigMap Configuration
# ==============================================================================
#
# This manifest defines comprehensive Grafana ConfigMap for the
# decentralized identity protocol, providing:
#
# ENTERPRISE VERIDIS GRAFANA CONFIGURATION ARCHITECTURE:
#   • Advanced Grafana configuration with intelligent dashboard management and performance-based visualization optimization
#   • Multi-tier configuration architecture with development, testing, staging, and production environments
#   • Comprehensive observability framework with configuration policies, dashboard optimization, Grafana integration
#   • Advanced lifecycle management with automated configuration optimization, Grafana control, and visualization enhancement
#   • Enterprise-grade intelligence with comprehensive analytics and Grafana configuration performance insights
#
# VERIDIS GRAFANA CONFIGURATION OPTIMIZATION:
#   • High-performance configuration with intelligent dashboard management and Grafana deployment optimization
#   • Intelligent configuration traffic management with responsive policies and performance-based dashboard decisions
#   • Advanced configuration management with business intelligence and visualization-based Grafana control
#   • Comprehensive observability control with intelligent Grafana configuration management and dashboard enhancement
#   • Enterprise acceleration with predictive Grafana configuration management and dashboard optimization
#
# COMPLIANCE FRAMEWORK INTEGRATION:
#   • SOC 2 Type II Grafana configuration controls with comprehensive audit and dashboard requirements
#   • GDPR Grafana configuration compliance with data protection, privacy controls, and dashboard management
#   • ISO 27001 Grafana configuration management with comprehensive framework integration
#   • NIST 800-190 container Grafana configuration security with dashboard-specific validation and compliance
#   • Zero-knowledge protocol compliance with regulatory frameworks and Grafana configuration best practices
#
# ENTERPRISE OPERATIONAL EXCELLENCE:
#   • Intelligent Grafana configuration lifecycle management with automated provisioning and dashboard optimization
#   • Predictive dashboard analytics with capacity planning and Grafana configuration intelligence
#   • Advanced configuration integration with Grafana dashboard analytics and visualization business intelligence
#   • Comprehensive observability control with Grafana configuration preservation and dashboard optimization
#   • Business continuity Grafana configuration with dashboard guarantees and visualization optimization
#
# GRAFANA CONFIGURATION ACCELERATION INTELLIGENCE:
#   • Grafana configuration usage analytics with dashboard patterns and optimization recommendations
#   • Configuration monitoring with Grafana dashboard latency and management optimization intelligence
#   • Development efficiency with Grafana configuration analytics and deployment optimization procedures
#   • Cost optimization with Grafana configuration utilization analysis and dashboard capacity planning procedures
#   • Quality assurance with Grafana configuration metrics and observability validation procedures
#
# ==============================================================================

# ==============================================================================
# Veridis Grafana ConfigMap - Main Configuration
# ==============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: veridis-grafana-config
  namespace: veridis-infrastructure

  # Core Veridis Grafana configuration identification labels
  labels:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "10.2.3"
    app.kubernetes.io/component: grafana-config
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    # Grafana configuration specific classification
    grafana.veridis.xyz/type: monitoring-grafana-config
    grafana.veridis.xyz/category: visualization-config
    grafana.veridis.xyz/role: primary-grafana-config
    grafana.veridis.xyz/config-class: high-performance-grafana-config
    grafana.veridis.xyz/security-level: enterprise

    # Monitoring Grafana configuration classification
    monitoring.veridis.xyz/grafana-config-type: intelligent-grafana-config
    monitoring.veridis.xyz/config-type: monitoring-config
    monitoring.veridis.xyz/performance-tier: high-performance
    monitoring.veridis.xyz/optimization: enabled
    monitoring.veridis.xyz/features: full-monitoring-config-stack

    # Observability Grafana configuration classification
    observability.veridis.xyz/tier: production
    observability.veridis.xyz/optimization: intelligent-monitoring-config-management
    observability.veridis.xyz/dashboard-management: advanced
    observability.veridis.xyz/visualization-optimization: enabled
    observability.veridis.xyz/efficiency: maximum

    # Business Grafana configuration classification
    business.veridis.xyz/criticality: mission-critical
    business.veridis.xyz/impact: high-monitoring-config-performance
    business.veridis.xyz/cost-tier: production
    business.veridis.xyz/sla-tier: enterprise
    business.veridis.xyz/availability-requirement: 99.9

    # Operational Grafana configuration labels
    veridis.xyz/environment: production
    veridis.xyz/team: monitoring-engineering
    veridis.xyz/cost-center: monitoring-infrastructure
    veridis.xyz/business-unit: identity-protocol

    # Compliance framework labels
    compliance.veridis.xyz/soc2: "grafana-config-control-framework"
    compliance.veridis.xyz/gdpr: "grafana-config-data-protection"
    compliance.veridis.xyz/iso27001: "grafana-config-security-management"
    compliance.veridis.xyz/nist-800-190: "grafana-config-container-security"
    governance.veridis.xyz/policy-enforcement: "enterprise"

    # Grafana configuration analytics and intelligence
    monitoring.veridis.xyz/grafana-config-monitoring: "enabled"
    monitoring.veridis.xyz/performance-monitoring: "comprehensive"
    monitoring.veridis.xyz/dashboard-monitoring: "enabled"
    monitoring.veridis.xyz/business-monitoring: "enabled"
    monitoring.veridis.xyz/compliance-monitoring: "enabled"

    # Configuration management labels
    config.veridis.xyz/type: "grafana-main"
    config.veridis.xyz/format: "ini"
    config.veridis.xyz/validation: "enabled"
    config.veridis.xyz/encryption: "enabled"
    config.veridis.xyz/backup-enabled: "true"

  annotations:
    # Grafana configuration purpose and specifications
    veridis.xyz/description: "Enterprise Veridis Grafana Configuration with intelligent dashboard management, advanced visualization optimization, and comprehensive observability optimization"
    veridis.xyz/purpose: "Provides comprehensive Grafana configuration for decentralized identity management with intelligent dashboard management, visualization optimization, and observability guarantees"
    veridis.xyz/scope: "Grafana configuration including dashboard management, visualization optimization, authentication integration, and comprehensive monitoring intelligence"

    # Grafana configuration architecture and design
    grafana.veridis.xyz/architecture: "Enterprise Grafana configuration with intelligent dashboard management, advanced visualization optimization, and authentication integration optimization"
    grafana.veridis.xyz/design-pattern: "Multi-tier Grafana configuration with dashboard optimization, cost efficiency, and business intelligence"
    grafana.veridis.xyz/optimization-model: "Intelligent Grafana configuration with predictive analytics, dashboard optimization, and visualization efficiency"
    grafana.veridis.xyz/performance-model: "High-performance Grafana configuration with dashboard optimization and intelligent visualization management"

    # Monitoring Grafana configuration specifications
    monitoring.veridis.xyz/grafana-config-specification: "Grafana configuration with dashboard optimization and intelligent monitoring config management"
    monitoring.veridis.xyz/dashboard-specification: "Advanced dashboard management configuration with monitoring optimization and config enhancement"
    monitoring.veridis.xyz/visualization-specification: "Grafana config visualization management optimization with intelligent dashboard and enhancement"
    monitoring.veridis.xyz/performance-specification: "Grafana performance config with dashboard acceleration and visualization efficiency"
    monitoring.veridis.xyz/business-specification: "Grafana business config with cost optimization and strategic dashboard intelligence"

    # Configuration specific annotations
    config.veridis.xyz/checksum: "sha256-placeholder"
    config.veridis.xyz/version: "10.2.3"
    config.veridis.xyz/format: "ini"
    config.veridis.xyz/encoding: "utf-8"
    config.veridis.xyz/validation: "enabled"

    # Security annotations
    security.veridis.xyz/configuration-security: "enhanced"
    security.veridis.xyz/secret-management: "external"
    security.veridis.xyz/encryption-at-rest: "enabled"
    security.veridis.xyz/access-control: "rbac"
    security.veridis.xyz/audit-logging: "enabled"

    # Performance annotations
    performance.veridis.xyz/optimization-level: "high"
    performance.veridis.xyz/caching-enabled: "true"
    performance.veridis.xyz/compression-enabled: "true"
    performance.veridis.xyz/memory-optimization: "enabled"
    performance.veridis.xyz/concurrent-users: "500"

    # Documentation and procedures
    veridis.xyz/owner: "monitoring-team@veridis.xyz"
    veridis.xyz/grafana-config-admin: "monitoring-admin@veridis.xyz"
    veridis.xyz/escalation: "monitoring-manager@veridis.xyz"
    veridis.xyz/emergency-contact: "monitoring-oncall@veridis.xyz"

    # Documentation references
    veridis.xyz/documentation: "https://docs.veridis.xyz/monitoring/grafana-config"
    veridis.xyz/runbook: "https://runbooks.veridis.xyz/monitoring/grafana-config-management"
    veridis.xyz/config-docs: "https://monitoring.veridis.xyz/grafana-config-guide"
    veridis.xyz/observability-docs: "https://observability.veridis.xyz/grafana-config-monitoring"

data:
  # ==============================================================================
  # Main Grafana Configuration File
  # ==============================================================================
  grafana.ini: |
    # ==============================================================================
    # Veridis Grafana Configuration - Enterprise Production Setup
    # ==============================================================================
    # This configuration provides comprehensive enterprise-grade Grafana setup
    # with advanced security, performance optimization, and business intelligence
    # integration for the Veridis decentralized identity protocol.
    # ==============================================================================

    # ==============================================================================
    # Application Configuration
    # ==============================================================================
    [app_mode]
    production

    # ==============================================================================
    # Instance Configuration
    # ==============================================================================
    [instance_name]
    veridis-grafana-production

    # ==============================================================================
    # Global Paths Configuration
    # ==============================================================================
    [paths]
    data = /var/lib/grafana
    logs = /var/log/grafana
    plugins = /var/lib/grafana/plugins
    provisioning = /etc/grafana/provisioning

    # ==============================================================================
    # Server Configuration
    # ==============================================================================
    [server]
    # Network configuration
    protocol = https
    http_addr = 0.0.0.0
    http_port = 3000
    domain = monitoring.veridis.xyz
    root_url = https://monitoring.veridis.xyz/grafana
    serve_from_sub_path = true

    # TLS configuration
    cert_file = /etc/grafana/tls/tls.crt
    cert_key = /etc/grafana/tls/tls.key

    # Security headers
    enable_gzip = true
    static_root_path = public
    router_logging = true

    # Performance configuration
    read_timeout = 0
    write_timeout = 0
    grace_period_before_shutdown = 30s

    # Static file configuration
    enforce_domain = true
    enable_gzip = true

    # ==============================================================================
    # Database Configuration
    # ==============================================================================
    [database]
    type = postgres
    host = veridis-postgres.veridis-infrastructure.svc.cluster.local:5432
    name = grafana
    user = ${GF_DATABASE_USER}
    password = ${GF_DATABASE_PASSWORD}
    ssl_mode = require

    # Connection pool configuration
    max_idle_conn = 25
    max_open_conn = 100
    conn_max_lifetime = 14400

    # Query configuration
    query_retries = 3
    query_timeout = 60

    # Database optimization
    log_queries = false
    cache_mode = private

    # ==============================================================================
    # Caching Configuration
    # ==============================================================================
    [remote_cache]
    type = redis
    connstr = addr=veridis-redis.veridis-infrastructure.svc.cluster.local:6379,pool_size=100,db=1,password=${REDIS_PASSWORD}

    # ==============================================================================
    # Data Source Cache Configuration
    # ==============================================================================
    [dataproxy]
    logging = true
    timeout = 30
    send_user_header = false
    keep_cookies =

    # Data source timeout configuration
    dialTimeout = 30
    keep_alive_seconds = 30

    # ==============================================================================
    # Security Configuration
    # ==============================================================================
    [security]
    # Admin configuration
    admin_user = ${GF_SECURITY_ADMIN_USER}
    admin_password = ${GF_SECURITY_ADMIN_PASSWORD}
    secret_key = ${GF_SECURITY_SECRET_KEY}

    # Security hardening
    disable_gravatar = true
    data_source_proxy_whitelist =
    disable_brute_force_login_protection = false
    cookie_secure = true
    cookie_samesite = strict
    allow_embedding = false
    strict_transport_security = true
    strict_transport_security_max_age_seconds = 86400
    strict_transport_security_preload = true
    strict_transport_security_subdomains = true
    x_content_type_options = true
    x_xss_protection = true
    content_type_protection = true

    # Login configuration
    login_remember_days = 7
    login_maximum_inactive_lifetime_duration = 7d
    login_maximum_lifetime_duration = 30d
    token_rotation_interval_minutes = 10

    # Password policy
    disable_initial_admin_creation = false
    password_hint = Your password must be at least 12 characters long and contain uppercase, lowercase, numbers, and special characters

    # API security
    disable_legacy_api_keys = true
    api_key_max_seconds_to_live = 86400

    # ==============================================================================
    # User Management Configuration
    # ==============================================================================
    [users]
    allow_sign_up = false
    allow_org_create = false
    auto_assign_org = true
    auto_assign_org_id = 1
    auto_assign_org_role = Viewer
    verify_email_enabled = true
    login_hint = Use your Veridis corporate credentials
    password_hint = Your password must be at least 12 characters long
    default_theme = dark
    home_page = /dashboards
    external_manage_link_url = https://auth.veridis.xyz/profile
    external_manage_link_name = Manage Account
    external_manage_info = Manage your account settings through Veridis Identity Provider
    viewers_can_edit = false
    editors_can_admin = false
    user_invite_max_lifetime_duration = 24h

    # ==============================================================================
    # Authentication Configuration
    # ==============================================================================
    [auth]
    login_cookie_name = grafana_sess
    login_maximum_inactive_lifetime_duration = 7d
    login_maximum_lifetime_duration = 30d
    token_rotation_interval_minutes = 10
    disable_login_form = false
    disable_signout_menu = false
    signout_redirect_url = https://auth.veridis.xyz/logout
    oauth_auto_login = true
    oauth_state_cookie_max_age = 600
    api_key_max_seconds_to_live = 86400

    # Session configuration
    [session]
    provider = redis
    provider_config = addr=veridis-redis.veridis-infrastructure.svc.cluster.local:6379,pool_size=100,db=2,password=${REDIS_PASSWORD}
    cookie_name = grafana_sess
    cookie_secure = true
    cookie_max_age = 86400
    session_life_time = 86400
    gc_interval_time = 86400

    # ==============================================================================
    # OAuth Configuration
    # ==============================================================================
    [auth.generic_oauth]
    enabled = true
    name = Veridis OAuth
    allow_sign_up = true
    client_id = ${GF_AUTH_GENERIC_OAUTH_CLIENT_ID}
    client_secret = ${GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET}
    scopes = openid profile email groups
    empty_scopes = false
    auth_url = https://auth.veridis.xyz/oauth/authorize
    token_url = https://auth.veridis.xyz/oauth/token
    api_url = https://auth.veridis.xyz/oauth/userinfo
    teams_url = https://auth.veridis.xyz/oauth/teams
    allowed_domains = veridis.xyz
    team_ids =
    allowed_organizations = veridis
    role_attribute_path = contains(groups[*], 'veridis-admin') && 'Admin' || contains(groups[*], 'veridis-editor') && 'Editor' || 'Viewer'
    role_attribute_strict = false
    allow_assign_grafana_admin = true
    skip_org_role_sync = false
    use_pkce = true
    use_refresh_token = true

    # TLS configuration for OAuth
    tls_skip_verify_insecure = false
    tls_client_cert =
    tls_client_key =
    tls_client_ca =

    # ==============================================================================
    # LDAP Configuration (Alternative)
    # ==============================================================================
    [auth.ldap]
    enabled = false
    config_file = /etc/grafana/ldap.toml
    allow_sign_up = false
    sync_cron = "0 0 1 * * *"
    active_sync_enabled = true

    # ==============================================================================
    # Anonymous Authentication
    # ==============================================================================
    [auth.anonymous]
    enabled = false
    org_name = Veridis
    org_role = Viewer
    hide_version = true

    # ==============================================================================
    # Logging Configuration
    # ==============================================================================
    [log]
    mode = console file
    level = info
    filters =

    [log.console]
    level = info
    format = json

    [log.file]
    level = info
    format = json
    log_rotate = true
    max_lines = 1000000
    max_size_shift = 28
    daily_rotate = true
    max_days = 7

    # ==============================================================================
    # Metrics Configuration
    # ==============================================================================
    [metrics]
    enabled = true
    interval_seconds = 10
    disable_total_stats = false
    basic_auth_username = grafana
    basic_auth_password = ${GF_METRICS_BASIC_AUTH_PASSWORD}

    [metrics.environment_info]
    exporter = prometheus

    # ==============================================================================
    # Alerting Configuration
    # ==============================================================================
    [alerting]
    enabled = true
    execute_alerts = true
    error_or_timeout = alerting
    nodata_or_nullvalues = no_data
    concurrent_render_limit = 5
    evaluation_timeout_seconds = 30
    notification_timeout_seconds = 30
    max_attempts = 3
    min_interval_seconds = 10

    # Unified alerting
    [unified_alerting]
    enabled = true
    execute_alerts = true
    evaluation_timeout = 30s
    max_attempts = 3
    min_interval = 10s

    # Screenshots
    [unified_alerting.screenshots]
    capture = true
    capture_timeout = 10s
    max_concurrent_screenshots = 2
    upload_external_image_storage = false

    # ==============================================================================
    # SMTP Configuration
    # ==============================================================================
    [smtp]
    enabled = true
    host = smtp.veridis.xyz:587
    user = ${GF_SMTP_USER}
    password = ${GF_SMTP_PASSWORD}
    cert_file =
    key_file =
    skip_verify = false
    from_address = grafana@veridis.xyz
    from_name = Veridis Grafana
    ehlo_identity = grafana.veridis.xyz
    startTLS_policy = MandatoryStartTLS
    enable_tracing = true

    # ==============================================================================
    # Rendering Configuration
    # ==============================================================================
    [rendering]
    server_url = http://veridis-grafana-renderer.veridis-infrastructure.svc.cluster.local:8081/render
    callback_url = http://veridis-grafana.veridis-infrastructure.svc.cluster.local:3000/
    concurrent_render_request_limit = 30
    rendering_timeout = 20s
    rendering_language = en-US
    rendering_timezone = UTC
    rendering_ignore_https_errors = false
    rendering_verbose_logging = false
    rendering_dumpio = false
    rendering_args =
    rendering_chrome_bin =
    rendering_mode = default
    rendering_clustering_mode = default
    rendering_clustering_max_concurrency = 5
    rendering_viewport_device_scale_factor = 1
    rendering_ignore_https_errors = false
    rendering_viewport_max_device_scale_factor = 4

    # ==============================================================================
    # Panels Configuration
    # ==============================================================================
    [panels]
    enable_alpha = true
    disable_sanitize_html = false

    # ==============================================================================
    # Plugin Configuration
    # ==============================================================================
    [plugins]
    enable_alpha = true
    app_tls_skip_verify_insecure = false
    allow_loading_unsigned_plugins = redis-datasource,postgres-datasource
    plugin_admin_enabled = true
    plugin_admin_external_manage_enabled = false
    plugin_catalog_url = https://grafana.com/api/plugins
    plugin_catalog_hidden_plugins =

    # ==============================================================================
    # Live Configuration
    # ==============================================================================
    [live]
    max_connections = 100
    allowed_origins = https://monitoring.veridis.xyz

    # ==============================================================================
    # Query History Configuration
    # ==============================================================================
    [query_history]
    enabled = true

    # ==============================================================================
    # Explore Configuration
    # ==============================================================================
    [explore]
    enabled = true

    # ==============================================================================
    # Help Configuration
    # ==============================================================================
    [help]
    enabled = true

    # ==============================================================================
    # Profile Configuration
    # ==============================================================================
    [profile]
    enabled = true

    # ==============================================================================
    # News Configuration
    # ==============================================================================
    [news]
    news_feed_enabled = false

    # ==============================================================================
    # Analytics Configuration
    # ==============================================================================
    [analytics]
    reporting_enabled = false
    check_for_updates = false
    check_for_plugin_updates = false
    google_analytics_ua_id =
    google_tag_manager_id =

    # ==============================================================================
    # Snapshots Configuration
    # ==============================================================================
    [snapshots]
    external_enabled = false
    external_snapshot_url =
    external_snapshot_name =
    public_mode = false
    snapshot_remove_expired = true

    # ==============================================================================
    # External Image Storage Configuration
    # ==============================================================================
    [external_image_storage]
    provider =

    # ==============================================================================
    # Enterprise Configuration
    # ==============================================================================
    [enterprise]
    license_path =

    # ==============================================================================
    # Feature Toggles Configuration
    # ==============================================================================
    [feature_toggles]
    enable = publicDashboards,panelTitleSearch,tempoApmTable,prometheusMetricEncyclopedia,dashboardPreviews,live-config-enabled,live-pipeline,correlations,datasourceQueryMultiStatus,traceToMetrics,newNavigation,customBranding,dashboardComments,annotationComments,migrationLocking,storage,cloudWatchDynamicLabels,dashboardScene,panelFilterVariable,newDashboardWithFilePicker

    # ==============================================================================
    # Custom Configuration
    # ==============================================================================
    [veridis]
    # Custom Veridis-specific configuration
    environment = production
    protocol_version = 3.2.1
    monitoring_tier = enterprise
    compliance_mode = enabled
    audit_retention_days = 365

    # Business intelligence configuration
    business_metrics_enabled = true
    cost_tracking_enabled = true
    performance_analytics_enabled = true
    user_analytics_enabled = true

    # Integration configuration
    starknet_integration = enabled
    zk_circuits_monitoring = enabled
    identity_analytics = enabled
    bridge_monitoring = enabled

---
# ==============================================================================
# Veridis Grafana ConfigMap - Dashboard Provisioning Configuration
# ==============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: veridis-grafana-dashboard-provisioning
  namespace: veridis-infrastructure

  labels:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "10.2.3"
    app.kubernetes.io/component: grafana-dashboard-provisioning
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    grafana.veridis.xyz/type: monitoring-grafana-dashboard-provisioning
    grafana.veridis.xyz/category: visualization-provisioning
    grafana.veridis.xyz/role: dashboard-provisioning-config

    config.veridis.xyz/type: "dashboard-provisioning"
    config.veridis.xyz/format: "yaml"

    veridis.xyz/environment: production
    veridis.xyz/team: monitoring-engineering

  annotations:
    veridis.xyz/description: "Dashboard provisioning configuration for Grafana with comprehensive dashboard management"
    veridis.xyz/purpose: "Provides dashboard provisioning for Grafana with automated dashboard import and management"

data:
  # ==============================================================================
  # Dashboard Provisioning Configuration
  # ==============================================================================
  dashboards.yaml: |
    # ==============================================================================
    # Veridis Grafana Dashboard Provisioning Configuration
    # ==============================================================================
    apiVersion: 1

    providers:
      # ==============================================================================
      # Veridis Application Dashboards
      # ==============================================================================
      - name: 'veridis-dashboards'
        orgId: 1
        folder: 'Veridis Protocol'
        type: file
        disableDeletion: false
        updateIntervalSeconds: 30
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards/veridis
          foldersFromFilesStructure: true

      # ==============================================================================
      # Infrastructure Dashboards
      # ==============================================================================
      - name: 'infrastructure-dashboards'
        orgId: 1
        folder: 'Infrastructure'
        type: file
        disableDeletion: false
        updateIntervalSeconds: 30
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards/infrastructure
          foldersFromFilesStructure: true

      # ==============================================================================
      # Business Intelligence Dashboards
      # ==============================================================================
      - name: 'business-dashboards'
        orgId: 1
        folder: 'Business Intelligence'
        type: file
        disableDeletion: false
        updateIntervalSeconds: 30
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards/business
          foldersFromFilesStructure: true

      # ==============================================================================
      # Security and Compliance Dashboards
      # ==============================================================================
      - name: 'security-dashboards'
        orgId: 1
        folder: 'Security & Compliance'
        type: file
        disableDeletion: false
        updateIntervalSeconds: 30
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards/security
          foldersFromFilesStructure: true

      # ==============================================================================
      # Custom Team Dashboards
      # ==============================================================================
      - name: 'custom-dashboards'
        orgId: 1
        folder: 'Custom'
        type: file
        disableDeletion: true
        updateIntervalSeconds: 60
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards/custom
          foldersFromFilesStructure: true

---
# ==============================================================================
# Veridis Grafana ConfigMap - Data Source Provisioning Configuration
# ==============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: veridis-grafana-datasource-provisioning
  namespace: veridis-infrastructure

  labels:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "10.2.3"
    app.kubernetes.io/component: grafana-datasource-provisioning
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    grafana.veridis.xyz/type: monitoring-grafana-datasource-provisioning
    grafana.veridis.xyz/category: visualization-datasource-provisioning
    grafana.veridis.xyz/role: datasource-provisioning-config

    config.veridis.xyz/type: "datasource-provisioning"
    config.veridis.xyz/format: "yaml"

    veridis.xyz/environment: production
    veridis.xyz/team: monitoring-engineering

  annotations:
    veridis.xyz/description: "Data source provisioning configuration for Grafana with comprehensive data source management"
    veridis.xyz/purpose: "Provides data source provisioning for Grafana with automated data source configuration and management"

data:
  # ==============================================================================
  # Data Source Provisioning Configuration
  # ==============================================================================
  datasources.yaml: |
    # ==============================================================================
    # Veridis Grafana Data Source Provisioning Configuration
    # ==============================================================================
    apiVersion: 1

    deleteDatasources:
      - name: Prometheus
        orgId: 1
      - name: Jaeger
        orgId: 1
      - name: Elasticsearch
        orgId: 1
      - name: PostgreSQL
        orgId: 1
      - name: Redis
        orgId: 1

    datasources:
      # ==============================================================================
      # Prometheus Data Source
      # ==============================================================================
      - name: Prometheus
        type: prometheus
        access: proxy
        orgId: 1
        uid: prometheus-veridis
        url: http://veridis-prometheus.veridis-infrastructure.svc.cluster.local:9090
        isDefault: true
        version: 1
        editable: false

        jsonData:
          httpMethod: POST
          manageAlerts: true
          alertmanagerUid: alertmanager-veridis
          prometheusType: Prometheus
          prometheusVersion: 2.45.0
          cacheLevel: High
          disableRecordingRules: false
          incrementalQueryOverlapWindow: 10m
          queryTimeout: 60s
          defaultEditor: code

        secureJsonData:
          httpHeaderValue1: "Bearer ${PROMETHEUS_API_TOKEN}"

        httpHeaderName1: "Authorization"

      # ==============================================================================
      # Jaeger Data Source
      # ==============================================================================
      - name: Jaeger
        type: jaeger
        access: proxy
        orgId: 1
        uid: jaeger-veridis
        url: http://veridis-jaeger-query.veridis-infrastructure.svc.cluster.local:16686
        isDefault: false
        version: 1
        editable: false

        jsonData:
          tracesToLogs:
            datasourceUid: elasticsearch-veridis
            tags: ['job', 'instance', 'pod', 'namespace']
            mappedTags: [
              { key: 'service.name', value: 'service' },
              { key: 'service.namespace', value: 'namespace' }
            ]
            mapTagNamesEnabled: true
            spanStartTimeShift: '1h'
            spanEndTimeShift: '1h'
            filterByTraceID: true
            filterBySpanID: true

          tracesToMetrics:
            datasourceUid: prometheus-veridis
            tags: [
              { key: 'service.name', value: 'service' },
              { key: 'job' }
            ]
            queries: [
              {
                name: 'Sample query',
                query: 'sum(rate(traces_spanmetrics_latency_bucket{$$__tags}[5m]))'
              }
            ]

          nodeGraph:
            enabled: true

          search:
            hide: false

          spanBar:
            type: Tag
            tag: http.status_code

      # ==============================================================================
      # Elasticsearch Data Source
      # ==============================================================================
      - name: Elasticsearch
        type: elasticsearch
        access: proxy
        orgId: 1
        uid: elasticsearch-veridis
        url: http://veridis-elasticsearch.veridis-infrastructure.svc.cluster.local:9200
        isDefault: false
        version: 1
        editable: false
        database: "logs-*"

        jsonData:
          index: "logs-*"
          timeField: "@timestamp"
          esVersion: "8.11.0"
          logMessageField: "message"
          logLevelField: "level"
          maxConcurrentShardRequests: 5
          includeFrozen: false
          xpack: false

        secureJsonData:
          basicAuthPassword: "${ELASTICSEARCH_PASSWORD}"

        basicAuth: true
        basicAuthUser: "${ELASTICSEARCH_USERNAME}"

      # ==============================================================================
      # PostgreSQL Data Source
      # ==============================================================================
      - name: PostgreSQL
        type: postgres
        access: proxy
        orgId: 1
        uid: postgresql-veridis
        url: veridis-postgres.veridis-infrastructure.svc.cluster.local:5432
        isDefault: false
        version: 1
        editable: false
        database: grafana

        jsonData:
          sslmode: require
          maxOpenConns: 100
          maxIdleConns: 100
          maxIdleConnsAuto: true
          connMaxLifetime: 14400
          postgresVersion: 1600
          timescaledb: false

        secureJsonData:
          password: "${POSTGRESQL_PASSWORD}"

        user: "${POSTGRESQL_USERNAME}"

      # ==============================================================================
      # Redis Data Source
      # ==============================================================================
      - name: Redis
        type: redis-datasource
        access: proxy
        orgId: 1
        uid: redis-veridis
        url: redis://veridis-redis.veridis-infrastructure.svc.cluster.local:6379
        isDefault: false
        version: 1
        editable: false

        jsonData:
          client: standalone
          poolSize: 5
          timeout: 10
          pingInterval: 0
          pipelineWindow: 0

        secureJsonData:
          password: "${REDIS_PASSWORD}"

      # ==============================================================================
      # StarkNet Metrics Data Source (Custom)
      # ==============================================================================
      - name: StarkNet Metrics
        type: prometheus
        access: proxy
        orgId: 1
        uid: starknet-metrics-veridis
        url: http://veridis-starknet-devnet.veridis-infrastructure.svc.cluster.local:5051/metrics
        isDefault: false
        version: 1
        editable: false

        jsonData:
          httpMethod: GET
          manageAlerts: false
          prometheusType: Prometheus
          prometheusVersion: 2.45.0
          cacheLevel: Medium
          queryTimeout: 30s
          defaultEditor: code

      # ==============================================================================
      # Vault Metrics Data Source
      # ==============================================================================
      - name: Vault Metrics
        type: prometheus
        access: proxy
        orgId: 1
        uid: vault-metrics-veridis
        url: http://veridis-vault.veridis-infrastructure.svc.cluster.local:8200/v1/sys/metrics
        isDefault: false
        version: 1
        editable: false

        jsonData:
          httpMethod: GET
          manageAlerts: false
          prometheusType: Prometheus
          prometheusVersion: 2.45.0
          cacheLevel: Medium
          queryTimeout: 30s
          defaultEditor: code

        httpHeaderName1: "X-Vault-Token"
        secureJsonData:
          httpHeaderValue1: "${VAULT_TOKEN}"

---
# ==============================================================================
# Veridis Grafana ConfigMap - LDAP Configuration (Optional)
# ==============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: veridis-grafana-ldap-config
  namespace: veridis-infrastructure

  labels:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "10.2.3"
    app.kubernetes.io/component: grafana-ldap-config
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    grafana.veridis.xyz/type: monitoring-grafana-ldap-config
    grafana.veridis.xyz/category: visualization-ldap-config
    grafana.veridis.xyz/role: ldap-config

    config.veridis.xyz/type: "ldap-config"
    config.veridis.xyz/format: "toml"

    veridis.xyz/environment: production
    veridis.xyz/team: monitoring-engineering

  annotations:
    veridis.xyz/description: "LDAP configuration for Grafana authentication (alternative to OAuth)"
    veridis.xyz/purpose: "Provides LDAP authentication configuration for Grafana as an alternative to OAuth"
    deployment.veridis.xyz/condition: "ldap-auth-enabled"

data:
  # ==============================================================================
  # LDAP Configuration File
  # ==============================================================================
  ldap.toml: |
    # ==============================================================================
    # Veridis Grafana LDAP Configuration
    # ==============================================================================
    # Alternative authentication method for environments where OAuth is not available
    # ==============================================================================

    [[servers]]
    # LDAP server configuration
    host = "ldap.veridis.xyz"
    port = 636
    use_ssl = true
    start_tls = false
    ssl_skip_verify = false
    root_ca_cert = "/etc/ssl/certs/ca-certificates.crt"
    client_cert = ""
    client_key = ""

    # Bind configuration
    bind_dn = "cn=grafana,ou=service-accounts,dc=veridis,dc=xyz"
    bind_password = "${LDAP_BIND_PASSWORD}"

    # Search configuration
    search_filter = "(cn=%s)"
    search_base_dns = ["ou=users,dc=veridis,dc=xyz"]

    # Group search
    group_search_filter = "(&(objectClass=posixGroup)(memberUid=%s))"
    group_search_base_dns = ["ou=groups,dc=veridis,dc=xyz"]
    group_search_filter_user_attribute = "distinguishedName"

    # User attribute mapping
    [servers.attributes]
    name = "givenName"
    surname = "sn"
    username = "cn"
    member_of = "memberOf"
    email = "mail"

    # Group mappings
    [[servers.group_mappings]]
    group_dn = "cn=veridis-admin,ou=groups,dc=veridis,dc=xyz"
    org_role = "Admin"
    grafana_admin = true

    [[servers.group_mappings]]
    group_dn = "cn=veridis-editor,ou=groups,dc=veridis,dc=xyz"
    org_role = "Editor"

    [[servers.group_mappings]]
    group_dn = "cn=veridis-viewer,ou=groups,dc=veridis,dc=xyz"
    org_role = "Viewer"

---
# ==============================================================================
# Veridis Grafana ConfigMap - Notification Policies Configuration
# ==============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: veridis-grafana-notification-config
  namespace: veridis-infrastructure

  labels:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "10.2.3"
    app.kubernetes.io/component: grafana-notification-config
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    grafana.veridis.xyz/type: monitoring-grafana-notification-config
    grafana.veridis.xyz/category: visualization-notification-config
    grafana.veridis.xyz/role: notification-config

    config.veridis.xyz/type: "notification-config"
    config.veridis.xyz/format: "yaml"

    veridis.xyz/environment: production
    veridis.xyz/team: monitoring-engineering

  annotations:
    veridis.xyz/description: "Notification policies configuration for Grafana alerting"
    veridis.xyz/purpose: "Provides notification policies for Grafana unified alerting system"

data:
  # ==============================================================================
  # Notification Policies Configuration
  # ==============================================================================
  notification-policies.yaml: |
    # ==============================================================================
    # Veridis Grafana Notification Policies Configuration
    # ==============================================================================

    # Contact points configuration
    contactPoints:
      - name: "veridis-email-alerts"
        type: "email"
        settings:
          addresses: ["alerts@veridis.xyz", "monitoring-team@veridis.xyz"]
          subject: "[Veridis Alert] {{ .GroupLabels.alertname }}"
          message: |
            {{ range .Alerts }}
            Alert: {{ .Annotations.summary }}
            Description: {{ .Annotations.description }}
            Severity: {{ .Labels.severity }}
            Instance: {{ .Labels.instance }}
            Job: {{ .Labels.job }}
            Time: {{ .StartsAt }}
            {{ end }}

      - name: "veridis-slack-critical"
        type: "slack"
        settings:
          url: "${SLACK_WEBHOOK_CRITICAL}"
          channel: "#veridis-alerts-critical"
          username: "Grafana"
          title: "[CRITICAL] Veridis Alert"
          text: |
            {{ range .Alerts }}
            *Alert:* {{ .Annotations.summary }}
            *Description:* {{ .Annotations.description }}
            *Severity:* {{ .Labels.severity }}
            *Instance:* {{ .Labels.instance }}
            *Job:* {{ .Labels.job }}
            {{ end }}

      - name: "veridis-slack-warnings"
        type: "slack"
        settings:
          url: "${SLACK_WEBHOOK_WARNINGS}"
          channel: "#veridis-alerts-warnings"
          username: "Grafana"
          title: "[WARNING] Veridis Alert"
          text: |
            {{ range .Alerts }}
            *Alert:* {{ .Annotations.summary }}
            *Description:* {{ .Annotations.description }}
            *Severity:* {{ .Labels.severity }}
            *Instance:* {{ .Labels.instance }}
            {{ end }}

      - name: "veridis-pagerduty"
        type: "pagerduty"
        settings:
          integrationKey: "${PAGERDUTY_INTEGRATION_KEY}"
          severity: "critical"
          customDetails:
            environment: "production"
            team: "monitoring-engineering"
            protocol: "veridis"

    # Notification policies
    policies:
      receiver: "veridis-email-alerts"
      group_by: ["alertname", "cluster", "service"]
      group_wait: "30s"
      group_interval: "5m"
      repeat_interval: "12h"

      routes:
        - receiver: "veridis-slack-critical"
          matchers:
            - severity =~ "critical|emergency"
          group_wait: "0s"
          group_interval: "1m"
          repeat_interval: "1h"

        - receiver: "veridis-pagerduty"
          matchers:
            - severity = "critical"
            - alertname =~ ".*Down|.*Failed"
          group_wait: "0s"
          group_interval: "1m"
          repeat_interval: "30m"

        - receiver: "veridis-slack-warnings"
          matchers:
            - severity = "warning"
          group_wait: "1m"
          group_interval: "5m"
          repeat_interval: "6h"

        - receiver: "veridis-email-alerts"
          matchers:
            - severity = "info"
          group_wait: "5m"
          group_interval: "15m"
          repeat_interval: "24h"

# ==============================================================================
# Veridis Grafana ConfigMap Summary and Enterprise Architecture
# ==============================================================================
#
# COMPREHENSIVE VERIDIS GRAFANA CONFIGMAP STRATEGY:
# =================================================
#
# VERIDIS GRAFANA CONFIGMAP ARCHITECTURE OVERVIEW:
# ------------------------------------------------
# 1. Main Grafana Configuration (veridis-grafana-config):
#    - Comprehensive enterprise-grade Grafana configuration with intelligent dashboard management and advanced visualization optimization for production monitoring
#    - Advanced configuration management with server settings, database configuration, security hardening, and comprehensive authentication integration
#    - Multi-tier security architecture with OAuth2, LDAP support, session management, TLS encryption, and comprehensive security policies
#    - Enterprise configuration policies with PostgreSQL backend, Redis caching, SMTP integration, and comprehensive performance optimization
#    - Performance optimization with intelligent caching, rendering service, alerting configuration, and monitoring for maximum efficiency
#
# 2. Dashboard Provisioning Configuration (veridis-grafana-dashboard-provisioning):
#    - Dashboard management service with automated provisioning and comprehensive dashboard lifecycle management
#    - Advanced provisioning configuration with Veridis dashboards, infrastructure dashboards, business intelligence dashboards, and comprehensive category management
#    - Multi-category dashboard organization with application monitoring, infrastructure monitoring, security compliance, and comprehensive business intelligence
#    - Dashboard intelligence with automated updates (30s intervals), UI updates enabled, folder organization, and comprehensive dashboard coordination
#    - Performance excellence with efficient dashboard loading, category management, version control, and comprehensive dashboard optimization
#
# 3. Data Source Provisioning Configuration (veridis-grafana-datasource-provisioning):
#    - Data source management service with automated configuration and comprehensive data source integration
#    - Advanced data source configuration with Prometheus, Jaeger, Elasticsearch, PostgreSQL, Redis, and comprehensive multi-source integration
#    - Multi-tier data source optimization with metrics collection, tracing analysis, log aggregation, database analytics, and comprehensive data intelligence
#    - Data source intelligence with correlation features, trace-to-metrics mapping, log correlation, and comprehensive observability coordination
#    - Integration excellence with StarkNet metrics, Vault metrics, custom data sources, and comprehensive data analytics management
#
# 4. LDAP Configuration (veridis-grafana-ldap-config):
#    - Alternative authentication service with LDAP integration and comprehensive enterprise directory support
#    - LDAP configuration with secure connections (TLS), group mappings, role assignments, and comprehensive authentication management
#    - Enterprise directory optimization with user attribute mapping, group search, bind configuration, and comprehensive identity intelligence
#    - Authentication intelligence with role-based access (Admin/Editor/Viewer), group memberships, user provisioning, and comprehensive directory coordination
#    - Security excellence with TLS encryption, certificate validation, secure binding, and comprehensive authentication optimization
#
# 5. Notification Policies Configuration (veridis-grafana-notification-config):
#    - Alerting management service with notification policies and comprehensive incident response integration
#    - Notification configuration with email alerts, Slack integration, PagerDuty escalation, and comprehensive alert routing
#    - Multi-tier alerting optimization with severity-based routing, escalation policies, team notifications, and comprehensive incident intelligence
#    - Alert intelligence with contact points, notification policies, routing rules, and comprehensive alerting coordination
#    - Business excellence with escalation procedures, team assignments, SLA compliance, and comprehensive incident management
#
# ENTERPRISE GRAFANA CONFIGMAP FEATURES:
# ======================================
# Advanced Configuration Management and Security Integration:
#   - Comprehensive INI configuration with server settings, database configuration, security policies, and comprehensive enterprise configuration
#   - Intelligent security management with OAuth2 integration, session management, TLS encryption, and comprehensive authentication decisions
#   - Configuration discovery with validation, encryption at rest, backup procedures, and comprehensive configuration analytics
#   - Security management with certificate validation, access control, audit logging, and comprehensive security intelligence
#   - Performance tuning with caching optimization, connection pooling, timeout management, and intelligent configuration optimization
#
# Comprehensive Dashboard and Data Source Management:
#   - Multi-category dashboard provisioning with Veridis-specific, infrastructure, business intelligence, and comprehensive monitoring coverage
#   - Dashboard automation with automated provisioning, update intervals, folder organization, and comprehensive dashboard lifecycle
#   - Data source optimization with multi-source integration, correlation features, performance tuning, and comprehensive data access
#   - Business intelligence with custom dashboards, team management, role-based access, and comprehensive strategic insights
#   - Integration management with StarkNet, Vault, custom metrics, and comprehensive protocol-specific monitoring
#
# Enterprise Authentication and Authorization Management:
#   - OAuth2 integration with Veridis identity provider, role mapping, team synchronization, and comprehensive authentication management
#   - LDAP integration with enterprise directory, group mappings, secure connections, and comprehensive directory coordination
#   - Session management with Redis storage, secure cookies, timeout policies, and comprehensive session intelligence
#   - Access control with role-based permissions, organization management, team assignments, and comprehensive authorization management
#   - Security intelligence with audit logging, access tracking, compliance monitoring, and comprehensive security analytics
#
# Advanced Alerting and Notification Management:
#   - Multi-channel alerting with email notifications, Slack integration, PagerDuty escalation, and comprehensive incident response
#   - Notification optimization with severity-based routing, escalation policies, team assignments, and comprehensive alert management
#   - Alert intelligence with contact points, routing rules, repeat intervals, and comprehensive alerting coordination
#   - Incident management with escalation procedures, SLA compliance, team notifications, and comprehensive response coordination
#   - Business analytics with alert correlation, trend analysis, performance tracking, and comprehensive incident intelligence
#
# OPERATIONAL EXCELLENCE:
# ======================
# Grafana ConfigMap Lifecycle Management:
#   - Multi-ConfigMap deployment with main configuration, dashboard provisioning, data source provisioning, LDAP config, and notification policies
#   - Intelligent configuration management with predictive analytics and resource utilization correlation
#   - Advanced monitoring with comprehensive configuration analytics and management business intelligence
#   - Configuration validation with schema enforcement and deployment safety checks
#   - Automated optimization with configuration pattern analysis and management recommendation engine
#
# Security Integration and Compliance:
#   - SOC 2 Type II configuration controls with comprehensive audit requirements and configuration logging
#   - GDPR configuration compliance with data protection and privacy-preserving configuration management
#   - ISO 27001 configuration security management with information security and compliance integration
#   - NIST 800-190 container configuration security with validation and compliance
#   - Zero-trust configuration architecture with comprehensive encryption and authentication requirements
#
# Business Intelligence Integration:
#   - Configuration analytics with cost correlation and resource utilization optimization
#   - Performance analytics with user experience optimization and configuration business intelligence
#   - Management intelligence with pattern monitoring and configuration optimization recommendations
#   - Strategic planning with capacity management and configuration forecasting
#   - Business impact assessment with configuration performance correlation and availability tracking
#
# Developer Experience Excellence:
#   - Multi-environment configuration support with production, development, LDAP, and notification configurations
#   - Comprehensive documentation with configuration guides and troubleshooting procedures
#   - Environment-specific configurations with production, development, testing, and enterprise support
#   - Testing integration with configuration development workflow and debugging capabilities
#   - Configuration monitoring with comprehensive tracking and correlation
#
# ==============================================================================
