# ==============================================================================
# Veridis Decentralized Identity Protocol - StarkNet DevNet Service Monitor
# ==============================================================================
#
# This manifest defines comprehensive StarkNet DevNet service monitoring for the
# Veridis deployment, providing:
#
# ENTERPRISE STARKNET DEVNET MONITORING ARCHITECTURE:
#   • Advanced service monitoring with comprehensive blockchain observability and performance analytics
#   • Multi-tier monitoring architecture with development, testing, staging, and production-like observability
#   • Comprehensive monitoring security with access controls, audit capabilities, and data protection
#   • Advanced monitoring lifecycle management with automated provisioning, scaling, and optimization
#   • Enterprise-grade monitoring intelligence with comprehensive analytics and performance insights
#
# STARKNET DEVNET MONITORING PERFORMANCE OPTIMIZATION:
#   • High-performance metrics collection with Cairo v2.11.4 integration and MLIR optimization
#   • Intelligent metrics aggregation with compression, filtering, and intelligent storage management
#   • Advanced alerting management with intelligent escalation and automated response procedures
#   • Comprehensive dashboard integration with real-time analytics and business intelligence
#   • Enterprise monitoring acceleration with GPU-optimized metrics processing and analytics
#
# COMPLIANCE FRAMEWORK INTEGRATION:
#   • SOC 2 Type II monitoring controls with comprehensive audit and observability requirements
#   • GDPR monitoring compliance with data protection, privacy controls, and retention procedures
#   • ISO 27001 monitoring security management with comprehensive framework integration
#   • NIST 800-190 container monitoring with DevNet-specific validation and compliance
#   • Blockchain monitoring compliance with regulatory frameworks and observability best practices
#
# ENTERPRISE OPERATIONAL EXCELLENCE:
#   • Intelligent monitoring lifecycle management with automated provisioning and optimization
#   • Predictive monitoring analytics with capacity planning and performance intelligence
#   • Advanced alerting integration with monitoring analytics and business intelligence
#   • Comprehensive backup and recovery with monitoring data preservation and disaster preparedness
#   • Business continuity monitoring with failover capabilities and redundancy optimization
#
# CAIRO V2.11.4 BUSINESS INTELLIGENCE:
#   • Monitoring usage analytics with development patterns and optimization recommendations
#   • Performance monitoring with metrics latency and collection optimization intelligence
#   • Development efficiency with monitoring analytics and deployment optimization procedures
#   • Cost optimization with resource utilization analysis and capacity planning procedures
#   • Quality assurance with monitoring metrics and development validation procedures
#
# ==============================================================================

# ==============================================================================
# StarkNet DevNet Primary Service Monitor - Core Blockchain Observability
# ==============================================================================
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: starknet-devnet-primary
  namespace: veridis-infrastructure

  # Core StarkNet DevNet monitoring identification labels
  labels:
    app.kubernetes.io/name: starknet-devnet
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "0.1.25"
    app.kubernetes.io/component: blockchain-monitoring
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    # Monitoring specific classification
    monitoring.veridis.xyz/type: service-monitor
    monitoring.veridis.xyz/category: blockchain-observability
    monitoring.veridis.xyz/role: primary-monitoring
    monitoring.veridis.xyz/performance-class: high-frequency
    monitoring.veridis.xyz/security-level: development

    # Prometheus monitoring classification
    prometheus.veridis.xyz/scrape: "true"
    prometheus.veridis.xyz/instance: "veridis-production"
    prometheus.veridis.xyz/job: "starknet-devnet"
    prometheus.veridis.xyz/path: "/metrics"
    prometheus.veridis.xyz/scheme: "http"

    # Cairo monitoring classification
    cairo.veridis.xyz/version: "v2.11.4"
    cairo.veridis.xyz/optimization: mlir-enabled
    cairo.veridis.xyz/monitoring: comprehensive
    cairo.veridis.xyz/metrics-collection: advanced
    cairo.veridis.xyz/development-mode: enabled

    # Performance monitoring classification
    performance.veridis.xyz/tier: high-performance
    performance.veridis.xyz/frequency: high-frequency
    performance.veridis.xyz/latency-tier: low-latency
    performance.veridis.xyz/collection-tier: real-time
    performance.veridis.xyz/optimization: metrics-acceleration

    # Development monitoring classification
    development.veridis.xyz/environment: local-development
    development.veridis.xyz/metrics-support: comprehensive
    development.veridis.xyz/debugging: enabled
    development.veridis.xyz/analytics-support: advanced
    development.veridis.xyz/intelligence-support: enabled

    # Business monitoring classification
    business.veridis.xyz/criticality: development-critical
    business.veridis.xyz/impact: development-velocity
    business.veridis.xyz/cost-tier: development
    business.veridis.xyz/sla-tier: development
    business.veridis.xyz/availability-requirement: high

    # Operational monitoring labels
    veridis.xyz/environment: production
    veridis.xyz/team: blockchain-engineering
    veridis.xyz/cost-center: development-infrastructure
    veridis.xyz/business-unit: identity-protocol

    # Compliance framework labels
    compliance.veridis.xyz/soc2: "monitoring-control-framework"
    compliance.veridis.xyz/gdpr: "monitoring-data-protection"
    compliance.veridis.xyz/iso27001: "monitoring-security-management"
    compliance.veridis.xyz/nist-800-190: "monitoring-container-security"
    governance.veridis.xyz/policy-enforcement: "development"

    # Monitoring analytics and intelligence
    analytics.veridis.xyz/monitoring-analytics: "enabled"
    analytics.veridis.xyz/performance-analytics: "comprehensive"
    analytics.veridis.xyz/usage-analytics: "enabled"
    analytics.veridis.xyz/cost-analytics: "detailed"
    analytics.veridis.xyz/quality-analytics: "enabled"

  annotations:
    # Monitoring purpose and specifications
    veridis.xyz/description: "Enterprise StarkNet DevNet service monitoring for Veridis with Cairo v2.11.4 integration and comprehensive observability features"
    veridis.xyz/purpose: "Provides high-performance blockchain service monitoring for development, testing, and integration with comprehensive analytics"
    veridis.xyz/scope: "DevNet service monitoring including blockchain metrics, Cairo performance, GPU utilization, and development analytics"

    # Monitoring architecture and design
    monitoring.veridis.xyz/architecture: "Enterprise StarkNet DevNet monitoring with Cairo v2.11.4, Prometheus integration, and comprehensive observability features"
    monitoring.veridis.xyz/design-pattern: "High-frequency monitoring with real-time metrics, intelligent alerting, and development intelligence"
    monitoring.veridis.xyz/security-model: "Development security monitoring with access controls, audit capabilities, and comprehensive validation"
    monitoring.veridis.xyz/performance-model: "High-performance monitoring with metrics acceleration, compression, and optimization"

    # Prometheus monitoring specifications
    prometheus.veridis.xyz/monitoring-specification: "Prometheus service monitoring with Cairo v2.11.4 integration and comprehensive metrics collection"
    prometheus.veridis.xyz/scraping-specification: "High-frequency scraping with intelligent filtering and performance optimization"
    prometheus.veridis.xyz/storage-specification: "Metrics storage with compression, retention, and intelligent management"
    prometheus.veridis.xyz/alerting-specification: "Intelligent alerting with escalation procedures and automated response capabilities"

    # Cairo monitoring specifications
    cairo.veridis.xyz/metrics-specification: "Cairo v2.11.4 metrics collection with MLIR optimization and comprehensive performance analytics"
    cairo.veridis.xyz/performance-specification: "Performance monitoring with compilation metrics, execution analytics, and optimization intelligence"
    cairo.veridis.xyz/development-specification: "Development monitoring with debugging metrics and comprehensive analytics"
    cairo.veridis.xyz/optimization-specification: "MLIR-enabled monitoring optimization with performance intelligence and analytics"

    # Performance monitoring specifications
    performance.veridis.xyz/collection-specification: "High-frequency metrics collection with real-time analytics and optimization intelligence"
    performance.veridis.xyz/processing-specification: "Metrics processing with compression, filtering, and intelligent storage management"
    performance.veridis.xyz/alerting-specification: "Performance alerting with intelligent thresholds and automated response procedures"
    performance.veridis.xyz/optimization-specification: "Performance optimization with intelligent tuning and resource management"

    # Development monitoring specifications
    development.veridis.xyz/metrics-specification: "Development metrics collection with debugging support and comprehensive analytics"
    development.veridis.xyz/analytics-specification: "Development analytics with usage patterns and optimization recommendations"
    development.veridis.xyz/integration-specification: "Seamless integration with development tools and testing frameworks"
    development.veridis.xyz/intelligence-specification: "Development intelligence with automated insights and optimization procedures"

    # Business monitoring specifications
    business.veridis.xyz/velocity-specification: "Development velocity monitoring with metrics collection and optimization intelligence"
    business.veridis.xyz/efficiency-specification: "Resource efficiency monitoring with utilization analysis and cost optimization"
    business.veridis.xyz/quality-specification: "Quality assurance monitoring with comprehensive validation and analytics"
    business.veridis.xyz/productivity-specification: "Developer productivity monitoring with advanced analytics and intelligence"

    # Operational monitoring specifications
    operations.veridis.xyz/automation-specification: "Full automation monitoring with intelligent management and developer-friendly interfaces"
    operations.veridis.xyz/alerting-specification: "Comprehensive alerting with escalation procedures and automated response systems"
    operations.veridis.xyz/maintenance-specification: "Automated maintenance monitoring with optimization and efficiency procedures"
    operations.veridis.xyz/scaling-specification: "Intelligent scaling monitoring with capacity management and resource optimization"

    # Monitoring lifecycle specifications
    lifecycle.veridis.xyz/provisioning-specification: "Dynamic monitoring provisioning with automated setup and configuration management"
    lifecycle.veridis.xyz/collection-specification: "Metrics collection lifecycle with retention, compression, and intelligent management"
    lifecycle.veridis.xyz/optimization-specification: "Performance optimization monitoring with intelligent tuning and resource management"
    lifecycle.veridis.xyz/decommissioning-specification: "Safe decommissioning monitoring with data preservation and migration procedures"

    # Documentation and procedures
    veridis.xyz/owner: "blockchain-team@veridis.xyz"
    veridis.xyz/monitoring-admin: "starknet-monitoring-admin@veridis.xyz"
    veridis.xyz/escalation: "blockchain-manager@veridis.xyz"
    veridis.xyz/emergency-contact: "blockchain-oncall@veridis.xyz"

    # Documentation references
    veridis.xyz/documentation: "https://docs.veridis.xyz/infrastructure/starknet/devnet-monitoring"
    veridis.xyz/runbook: "https://runbooks.veridis.xyz/starknet/monitoring-management"
    veridis.xyz/monitoring-docs: "https://monitoring.veridis.xyz/starknet/service-monitoring"
    veridis.xyz/alerting-docs: "https://alerting.veridis.xyz/starknet/service-alerting"

spec:
  # ==============================================================================
  # Service Selector Configuration
  # ==============================================================================
  selector:
    matchLabels:
      app.kubernetes.io/name: starknet-devnet
      app.kubernetes.io/instance: veridis-production
      app.kubernetes.io/component: blockchain-devnet

  # ==============================================================================
  # Namespace Selector Configuration
  # ==============================================================================
  namespaceSelector:
    matchNames:
      - veridis-infrastructure

  # ==============================================================================
  # Endpoint Configuration - Comprehensive Metrics Collection
  # ==============================================================================
  endpoints:
    # Primary metrics endpoint for blockchain operations
    - port: metrics
      path: /metrics
      scheme: http
      interval: 30s
      scrapeTimeout: 10s
      honorLabels: true
      honorTimestamps: true

      # Metrics relabeling for intelligent processing
      metricRelabelings:
        # Add instance information
        - sourceLabels: [__meta_kubernetes_pod_name]
          targetLabel: instance
          replacement: "${1}"

        # Add namespace information
        - sourceLabels: [__meta_kubernetes_namespace]
          targetLabel: kubernetes_namespace
          replacement: "${1}"

        # Add service information
        - sourceLabels: [__meta_kubernetes_service_name]
          targetLabel: kubernetes_service
          replacement: "${1}"

        # Add Cairo version information
        - sourceLabels: [__meta_kubernetes_service_label_cairo_veridis_xyz_version]
          targetLabel: cairo_version
          replacement: "${1}"

        # Add performance tier information
        - sourceLabels: [__meta_kubernetes_service_label_performance_veridis_xyz_tier]
          targetLabel: performance_tier
          replacement: "${1}"

        # Add development environment information
        - sourceLabels: [__meta_kubernetes_service_label_development_veridis_xyz_environment]
          targetLabel: development_environment
          replacement: "${1}"

        # Filter out high-cardinality metrics for cost optimization
        - sourceLabels: [__name__]
          regex: 'go_.*'
          action: drop

        # Keep only essential blockchain metrics
        - sourceLabels: [__name__]
          regex: 'starknet_.*|cairo_.*|devnet_.*|blockchain_.*|veridis_.*'
          action: keep

      # Sample limit for cost control
      sampleLimit: 10000

      # Target limit for scalability
      targetLimit: 100

    # Health endpoint monitoring for service validation
    - port: health
      path: /health
      scheme: http
      interval: 15s
      scrapeTimeout: 5s
      honorLabels: true

      metricRelabelings:
        - sourceLabels: [__meta_kubernetes_pod_name]
          targetLabel: instance
          replacement: "${1}"

        - sourceLabels: [__name__]
          regex: 'health_.*|up'
          action: keep

      sampleLimit: 1000
      targetLimit: 50

    # Cairo-specific metrics endpoint for development analytics
    - port: metrics
      path: /cairo/metrics
      scheme: http
      interval: 60s
      scrapeTimeout: 15s
      honorLabels: true

      metricRelabelings:
        - sourceLabels: [__meta_kubernetes_pod_name]
          targetLabel: instance
          replacement: "${1}"

        - sourceLabels: [__name__]
          regex: 'cairo_.*|compilation_.*|mlir_.*|gpu_.*'
          action: keep

        # Add Cairo optimization information
        - sourceLabels: [__meta_kubernetes_service_label_cairo_veridis_xyz_optimization]
          targetLabel: cairo_optimization
          replacement: "${1}"

      sampleLimit: 5000
      targetLimit: 25

    # Performance metrics endpoint for optimization analytics
    - port: metrics
      path: /performance/metrics
      scheme: http
      interval: 45s
      scrapeTimeout: 12s
      honorLabels: true

      metricRelabelings:
        - sourceLabels: [__meta_kubernetes_pod_name]
          targetLabel: instance
          replacement: "${1}"

        - sourceLabels: [__name__]
          regex: 'performance_.*|latency_.*|throughput_.*|gpu_.*|memory_.*'
          action: keep

      sampleLimit: 3000
      targetLimit: 20

    # Development metrics endpoint for productivity analytics
    - port: metrics
      path: /development/metrics
      scheme: http
      interval: 120s
      scrapeTimeout: 20s
      honorLabels: true

      metricRelabelings:
        - sourceLabels: [__meta_kubernetes_pod_name]
          targetLabel: instance
          replacement: "${1}"

        - sourceLabels: [__name__]
          regex: 'development_.*|test_.*|deployment_.*|usage_.*'
          action: keep

      sampleLimit: 2000
      targetLimit: 15

  # ==============================================================================
  # Job Label Configuration
  # ==============================================================================
  jobLabel: "starknet-devnet-primary"

  # ==============================================================================
  # Pod Target Labels Configuration
  # ==============================================================================
  podTargetLabels:
    - "app.kubernetes.io/name"
    - "app.kubernetes.io/instance"
    - "app.kubernetes.io/version"
    - "app.kubernetes.io/component"
    - "cairo.veridis.xyz/version"
    - "performance.veridis.xyz/tier"
    - "development.veridis.xyz/environment"

  # ==============================================================================
  # Service Target Labels Configuration
  # ==============================================================================
  targetLabels:
    - "service.veridis.xyz/type"
    - "service.veridis.xyz/purpose"
    - "monitoring.veridis.xyz/type"
    - "cairo.veridis.xyz/optimization"
    - "performance.veridis.xyz/optimization"

---
# ==============================================================================
# StarkNet DevNet Performance Service Monitor - Advanced Performance Analytics
# ==============================================================================
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: starknet-devnet-performance
  namespace: veridis-infrastructure

  labels:
    app.kubernetes.io/name: starknet-devnet
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "0.1.25"
    app.kubernetes.io/component: performance-monitoring
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    monitoring.veridis.xyz/type: performance-monitor
    monitoring.veridis.xyz/category: performance-analytics
    monitoring.veridis.xyz/role: performance-optimization
    performance.veridis.xyz/tier: advanced-analytics
    cairo.veridis.xyz/performance-monitoring: enabled

    veridis.xyz/environment: production
    veridis.xyz/team: blockchain-engineering

  annotations:
    veridis.xyz/description: "Advanced StarkNet DevNet performance monitoring for Cairo v2.11.4 optimization and GPU analytics"
    veridis.xyz/purpose: "Provides comprehensive performance monitoring for Cairo compilation, GPU utilization, and optimization intelligence"

spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: starknet-devnet
      app.kubernetes.io/instance: veridis-production
      performance.veridis.xyz/monitoring: enabled

  namespaceSelector:
    matchNames:
      - veridis-infrastructure

  endpoints:
    # GPU performance metrics
    - port: metrics
      path: /gpu/metrics
      scheme: http
      interval: 30s
      scrapeTimeout: 10s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'gpu_.*|cuda_.*|opencl_.*|memory_gpu_.*|compute_.*'
          action: keep

        - sourceLabels: [__meta_kubernetes_pod_name]
          targetLabel: instance
          replacement: "${1}"

      sampleLimit: 2000

    # Cairo compilation performance metrics
    - port: metrics
      path: /cairo/performance
      scheme: http
      interval: 60s
      scrapeTimeout: 15s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'cairo_compilation_.*|mlir_.*|optimization_.*|cache_.*'
          action: keep

      sampleLimit: 1500

    # I/O performance metrics
    - port: metrics
      path: /io/metrics
      scheme: http
      interval: 45s
      scrapeTimeout: 12s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'io_.*|storage_.*|disk_.*|network_.*'
          action: keep

      sampleLimit: 1000

  jobLabel: "starknet-devnet-performance"

---
# ==============================================================================
# StarkNet DevNet Development Service Monitor - Development Analytics
# ==============================================================================
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: starknet-devnet-development
  namespace: veridis-infrastructure

  labels:
    app.kubernetes.io/name: starknet-devnet
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "0.1.25"
    app.kubernetes.io/component: development-monitoring
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    monitoring.veridis.xyz/type: development-monitor
    monitoring.veridis.xyz/category: development-analytics
    development.veridis.xyz/monitoring: comprehensive
    development.veridis.xyz/analytics: enabled

    veridis.xyz/environment: production
    veridis.xyz/team: blockchain-engineering

  annotations:
    veridis.xyz/description: "Comprehensive StarkNet DevNet development monitoring for productivity and quality analytics"
    veridis.xyz/purpose: "Provides development-focused monitoring for testing, debugging, and development velocity optimization"

spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: starknet-devnet
      app.kubernetes.io/instance: veridis-production
      development.veridis.xyz/monitoring: enabled

  namespaceSelector:
    matchNames:
      - veridis-infrastructure

  endpoints:
    # Development velocity metrics
    - port: metrics
      path: /development/velocity
      scheme: http
      interval: 300s  # 5 minutes
      scrapeTimeout: 30s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'development_velocity_.*|test_.*|deployment_.*|productivity_.*'
          action: keep

      sampleLimit: 500

    # Testing metrics
    - port: metrics
      path: /testing/metrics
      scheme: http
      interval: 180s  # 3 minutes
      scrapeTimeout: 20s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'test_.*|coverage_.*|quality_.*|validation_.*'
          action: keep

      sampleLimit: 800

    # Usage analytics metrics
    - port: metrics
      path: /usage/analytics
      scheme: http
      interval: 600s  # 10 minutes
      scrapeTimeout: 60s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'usage_.*|pattern_.*|frequency_.*|behavior_.*'
          action: keep

      sampleLimit: 300

  jobLabel: "starknet-devnet-development"

---
# ==============================================================================
# StarkNet DevNet Business Intelligence Service Monitor - Cost and Analytics
# ==============================================================================
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: starknet-devnet-business
  namespace: veridis-infrastructure

  labels:
    app.kubernetes.io/name: starknet-devnet
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "0.1.25"
    app.kubernetes.io/component: business-monitoring
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    monitoring.veridis.xyz/type: business-monitor
    monitoring.veridis.xyz/category: business-intelligence
    business.veridis.xyz/monitoring: enabled
    business.veridis.xyz/analytics: comprehensive

    veridis.xyz/environment: production
    veridis.xyz/team: blockchain-engineering

  annotations:
    veridis.xyz/description: "Business intelligence monitoring for StarkNet DevNet cost optimization and strategic analytics"
    veridis.xyz/purpose: "Provides business-focused monitoring for cost analysis, resource optimization, and strategic planning"

spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: starknet-devnet
      app.kubernetes.io/instance: veridis-production
      business.veridis.xyz/monitoring: enabled

  namespaceSelector:
    matchNames:
      - veridis-infrastructure

  endpoints:
    # Cost analytics metrics
    - port: metrics
      path: /business/cost
      scheme: http
      interval: 900s  # 15 minutes
      scrapeTimeout: 60s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'cost_.*|resource_utilization_.*|efficiency_.*|optimization_.*'
          action: keep

      sampleLimit: 200

    # Capacity planning metrics
    - port: metrics
      path: /business/capacity
      scheme: http
      interval: 1800s  # 30 minutes
      scrapeTimeout: 120s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'capacity_.*|planning_.*|forecast_.*|trend_.*'
          action: keep

      sampleLimit: 150

    # Quality metrics
    - port: metrics
      path: /business/quality
      scheme: http
      interval: 600s  # 10 minutes
      scrapeTimeout: 45s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'quality_.*|sla_.*|availability_.*|reliability_.*'
          action: keep

      sampleLimit: 100

  jobLabel: "starknet-devnet-business"

---
# ==============================================================================
# StarkNet DevNet Security Service Monitor - Security and Compliance Analytics
# ==============================================================================
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: starknet-devnet-security
  namespace: veridis-infrastructure

  labels:
    app.kubernetes.io/name: starknet-devnet
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/version: "0.1.25"
    app.kubernetes.io/component: security-monitoring
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    monitoring.veridis.xyz/type: security-monitor
    monitoring.veridis.xyz/category: security-analytics
    security.veridis.xyz/monitoring: enabled
    compliance.veridis.xyz/monitoring: comprehensive

    veridis.xyz/environment: production
    veridis.xyz/team: blockchain-engineering

  annotations:
    veridis.xyz/description: "Security and compliance monitoring for StarkNet DevNet with comprehensive audit capabilities"
    veridis.xyz/purpose: "Provides security-focused monitoring for compliance validation, audit trails, and risk management"

spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: starknet-devnet
      app.kubernetes.io/instance: veridis-production
      security.veridis.xyz/monitoring: enabled

  namespaceSelector:
    matchNames:
      - veridis-infrastructure

  endpoints:
    # Security metrics
    - port: metrics
      path: /security/metrics
      scheme: http
      interval: 120s  # 2 minutes
      scrapeTimeout: 30s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'security_.*|auth_.*|access_.*|audit_.*'
          action: keep

      sampleLimit: 1000

    # Compliance metrics
    - port: metrics
      path: /compliance/metrics
      scheme: http
      interval: 300s  # 5 minutes
      scrapeTimeout: 60s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'compliance_.*|soc2_.*|gdpr_.*|iso27001_.*|nist_.*'
          action: keep

      sampleLimit: 500

    # Risk assessment metrics
    - port: metrics
      path: /risk/metrics
      scheme: http
      interval: 600s  # 10 minutes
      scrapeTimeout: 90s

      metricRelabelings:
        - sourceLabels: [__name__]
          regex: 'risk_.*|threat_.*|vulnerability_.*|assessment_.*'
          action: keep

      sampleLimit: 300

  jobLabel: "starknet-devnet-security"

---
# ==============================================================================
# Prometheus Rule - StarkNet DevNet Alerting Rules
# ==============================================================================
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: starknet-devnet-alerts
  namespace: veridis-infrastructure

  labels:
    app.kubernetes.io/name: starknet-devnet
    app.kubernetes.io/instance: veridis-production
    app.kubernetes.io/component: alerting-rules
    app.kubernetes.io/part-of: veridis-protocol
    app.kubernetes.io/managed-by: kustomize

    prometheus.veridis.xyz/rules: starknet-devnet
    alerting.veridis.xyz/category: blockchain-alerts
    monitoring.veridis.xyz/alerting: enabled

  annotations:
    veridis.xyz/description: "Comprehensive alerting rules for StarkNet DevNet monitoring and operations"
    veridis.xyz/purpose: "Provides intelligent alerting for service health, performance, and business metrics"

spec:
  groups:
    # ==============================================================================
    # Service Health Alerts
    # ==============================================================================
    - name: starknet_devnet_service_health
      interval: 30s
      rules:
        - alert: StarkNetDevNetDown
          expr: up{job="starknet-devnet-primary"} == 0
          for: 1m
          labels:
            severity: critical
            service: starknet-devnet
            category: service-health
            team: blockchain-engineering
          annotations:
            summary: "StarkNet DevNet service is down"
            description: "StarkNet DevNet service has been down for more than 1 minute. Instance: {{ $labels.instance }}"
            runbook_url: "https://runbooks.veridis.xyz/starknet/service-down"
            dashboard_url: "https://grafana.veridis.xyz/d/starknet-devnet/overview"

        - alert: StarkNetDevNetHighLatency
          expr: histogram_quantile(0.95, rate(starknet_request_duration_seconds_bucket[5m])) > 1
          for: 2m
          labels:
            severity: warning
            service: starknet-devnet
            category: performance
            team: blockchain-engineering
          annotations:
            summary: "StarkNet DevNet high latency detected"
            description: "95th percentile latency is {{ $value }}s, above 1s threshold for 2 minutes"
            runbook_url: "https://runbooks.veridis.xyz/starknet/high-latency"

        - alert: StarkNetDevNetLowThroughput
          expr: rate(starknet_requests_total[5m]) < 10
          for: 5m
          labels:
            severity: warning
            service: starknet-devnet
            category: performance
            team: blockchain-engineering
          annotations:
            summary: "StarkNet DevNet low throughput detected"
            description: "Request rate is {{ $value }} req/s, below 10 req/s threshold for 5 minutes"

    # ==============================================================================
    # Cairo Performance Alerts
    # ==============================================================================
    - name: starknet_devnet_cairo_performance
      interval: 60s
      rules:
        - alert: CairoCompilationSlow
          expr: histogram_quantile(0.95, rate(cairo_compilation_duration_seconds_bucket[10m])) > 30
          for: 3m
          labels:
            severity: warning
            service: starknet-devnet
            category: cairo-performance
            team: blockchain-engineering
          annotations:
            summary: "Cairo compilation is slow"
            description: "95th percentile Cairo compilation time is {{ $value }}s, above 30s threshold"
            runbook_url: "https://runbooks.veridis.xyz/cairo/slow-compilation"

        - alert: MLIROptimizationFailure
          expr: increase(cairo_mlir_optimization_failures_total[10m]) > 5
          for: 1m
          labels:
            severity: critical
            service: starknet-devnet
            category: cairo-optimization
            team: blockchain-engineering
          annotations:
            summary: "MLIR optimization failures detected"
            description: "{{ $value }} MLIR optimization failures in the last 10 minutes"

        - alert: GPUUtilizationLow
          expr: avg(gpu_utilization_percent) < 20
          for: 10m
          labels:
            severity: info
            service: starknet-devnet
            category: gpu-performance
            team: blockchain-engineering
          annotations:
            summary: "GPU utilization is low"
            description: "Average GPU utilization is {{ $value }}%, below 20% for 10 minutes"

    # ==============================================================================
    # Resource Utilization Alerts
    # ==============================================================================
    - name: starknet_devnet_resources
      interval: 30s
      rules:
        - alert: HighCPUUsage
          expr: rate(container_cpu_usage_seconds_total{container="starknet-devnet"}[5m]) > 0.8
          for: 5m
          labels:
            severity: warning
            service: starknet-devnet
            category: resource-utilization
            team: blockchain-engineering
          annotations:
            summary: "High CPU usage detected"
            description: "CPU usage is {{ $value | humanizePercentage }}, above 80% for 5 minutes"

        - alert: HighMemoryUsage
          expr: container_memory_usage_bytes{container="starknet-devnet"} / container_spec_memory_limit_bytes > 0.85
          for: 5m
          labels:
            severity: warning
            service: starknet-devnet
            category: resource-utilization
            team: blockchain-engineering
          annotations:
            summary: "High memory usage detected"
            description: "Memory usage is {{ $value | humanizePercentage }}, above 85% for 5 minutes"

        - alert: StorageSpaceLow
          expr: (node_filesystem_avail_bytes{mountpoint="/app/state"} / node_filesystem_size_bytes) < 0.15
          for: 2m
          labels:
            severity: critical
            service: starknet-devnet
            category: storage
            team: blockchain-engineering
          annotations:
            summary: "Storage space is low"
            description: "Available storage is {{ $value | humanizePercentage }}, below 15%"

    # ==============================================================================
    # Development Velocity Alerts
    # ==============================================================================
    - name: starknet_devnet_development
      interval: 300s
      rules:
        - alert: DevelopmentVelocityLow
          expr: rate(development_deployments_total[1h]) < 1
          for: 2h
          labels:
            severity: info
            service: starknet-devnet
            category: development-velocity
            team: blockchain-engineering
          annotations:
            summary: "Development velocity is low"
            description: "Deployment rate is {{ $value }} per hour, below 1 deployment/hour for 2 hours"

        - alert: TestFailureRateHigh
          expr: rate(test_failures_total[30m]) / rate(test_runs_total[30m]) > 0.2
          for: 1h
          labels:
            severity: warning
            service: starknet-devnet
            category: test-quality
            team: blockchain-engineering
          annotations:
            summary: "Test failure rate is high"
            description: "Test failure rate is {{ $value | humanizePercentage }}, above 20% for 1 hour"

    # ==============================================================================
    # Business Intelligence Alerts
    # ==============================================================================
    - name: starknet_devnet_business
      interval: 900s
      rules:
        - alert: CostEfficiencyLow
          expr: cost_per_transaction_usd > 0.1
          for: 1h
          labels:
            severity: info
            service: starknet-devnet
            category: cost-optimization
            team: blockchain-engineering
          annotations:
            summary: "Cost efficiency is low"
            description: "Cost per transaction is ${{ $value }}, above $0.10 threshold"

        - alert: ResourceUtilizationInefficient
          expr: avg(resource_utilization_efficiency_percent) < 60
          for: 2h
          labels:
            severity: info
            service: starknet-devnet
            category: resource-efficiency
            team: blockchain-engineering
          annotations:
            summary: "Resource utilization is inefficient"
            description: "Average resource utilization efficiency is {{ $value }}%, below 60%"

# ==============================================================================
# StarkNet DevNet Service Monitor Summary and Enterprise Monitoring Architecture
# ==============================================================================
#
# COMPREHENSIVE STARKNET DEVNET MONITORING STRATEGY:
# ==================================================
#
# STARKNET DEVNET MONITORING ARCHITECTURE OVERVIEW:
# -------------------------------------------------
# 1. Primary Service Monitor (starknet-devnet-primary):
#    - Core blockchain metrics collection with Cairo v2.11.4 integration and comprehensive observability
#    - High-frequency monitoring with 30s intervals and intelligent metrics filtering
#    - Advanced metrics relabeling with instance identification and performance optimization
#    - Comprehensive endpoint monitoring including health, metrics, Cairo, performance, and development
#    - Enterprise-grade sample limits with cost control and scalability optimization
#
# 2. Performance Service Monitor (starknet-devnet-performance):
#    - Advanced performance analytics with GPU monitoring and Cairo compilation metrics
#    - Specialized monitoring for MLIR optimization and performance intelligence
#    - I/O performance tracking with storage and network analytics
#    - Performance optimization monitoring with intelligent threshold management
#    - Cost-efficient monitoring with optimized collection intervals and sample limits
#
# 3. Development Service Monitor (starknet-devnet-development):
#    - Development-focused monitoring with velocity and productivity analytics
#    - Comprehensive testing metrics with coverage and quality validation
#    - Usage analytics with pattern analysis and optimization recommendations
#    - Development intelligence with automated insights and productivity enhancement
#    - Team collaboration monitoring with efficiency and quality metrics
#
# 4. Business Intelligence Monitor (starknet-devnet-business):
#    - Cost optimization monitoring with resource utilization analysis and efficiency tracking
#    - Capacity planning analytics with forecasting and trend analysis
#    - Quality assurance monitoring with SLA validation and reliability metrics
#    - Strategic planning support with business intelligence and optimization recommendations
#    - Resource efficiency monitoring with cost analysis and optimization procedures
#
# 5. Security Service Monitor (starknet-devnet-security):
#    - Comprehensive security monitoring with audit trail collection and compliance validation
#    - Risk assessment analytics with threat detection and vulnerability analysis
#    - Compliance framework monitoring with SOC 2, GDPR, ISO 27001, and NIST validation
#    - Access control monitoring with authentication and authorization analytics
#    - Security intelligence with automated threat detection and response procedures
#
# ENTERPRISE MONITORING FEATURES:
# ===============================
# Advanced Metrics Collection and Processing:
#   - Multi-endpoint monitoring with specialized metrics collection for different use cases
#   - Intelligent metrics filtering with cost optimization and performance enhancement
#   - Advanced relabeling with instance identification and metadata enrichment
#   - Sample limits with cost control and scalability optimization
#   - Performance-optimized collection intervals with intelligent frequency management
#
# Comprehensive Alerting and Intelligence:
#   - Multi-category alerting with service health, performance, resources, development, and business
#   - Intelligent threshold management with automated escalation and response procedures
#   - Business intelligence integration with cost optimization and strategic planning
#   - Development velocity monitoring with productivity analytics and optimization
#   - Security and compliance alerting with risk assessment and threat detection
#
# Cairo v2.11.4 Optimization Monitoring:
#   - Specialized Cairo metrics collection with MLIR optimization and performance analytics
#   - GPU utilization monitoring with acceleration analytics and optimization intelligence
#   - Compilation performance tracking with development velocity optimization
#   - Cache efficiency monitoring with intelligent management and optimization
#   - Development intelligence with Cairo-specific insights and recommendations
#
# Enterprise Observability Integration:
#   - Prometheus integration with comprehensive service discovery and metrics collection
#   - Grafana dashboard integration with real-time analytics and business intelligence
#   - Alert manager integration with intelligent escalation and automated response
#   - Service mesh observability with distributed tracing and performance analytics
#   - Business intelligence integration with cost optimization and strategic planning
#
# OPERATIONAL EXCELLENCE:
# ======================
# Monitoring Lifecycle Management:
#   - Dynamic service discovery with automated endpoint registration and configuration
#   - Intelligent metrics retention with compression and storage optimization
#   - Alert lifecycle management with escalation procedures and automated response
#   - Dashboard automation with real-time updates and performance optimization
#   - Cost optimization with intelligent sampling and resource management
#
# Performance and Scalability:
#   - High-frequency monitoring with performance optimization and cost efficiency
#   - Intelligent sampling with cost control and scalability enhancement
#   - Metrics compression with storage optimization and retention management
#   - Query optimization with performance enhancement and resource efficiency
#   - Capacity planning with predictive analytics and intelligent scaling
#
# Security and Compliance Integration:
#   - Comprehensive audit trail collection with compliance validation and evidence preservation
#   - Access control monitoring with authentication and authorization analytics
#   - Compliance framework validation with automated reporting and evidence collection
#   - Risk assessment integration with threat detection and vulnerability analysis
#   - Security intelligence with automated response and mitigation procedures
#
# Business Intelligence and Analytics:
#   - Cost optimization monitoring with resource utilization analysis and efficiency tracking
#   - Development velocity analytics with productivity metrics and optimization intelligence
#   - Quality assurance monitoring with SLA validation and reliability analytics
#   - Strategic planning support with business intelligence and long-term optimization
#   - Resource efficiency analysis with cost optimization and capacity planning
#
# ==============================================================================
